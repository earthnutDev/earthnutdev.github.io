<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>花生亻 Blog</title>
        <link>https://earthnutDev.github.io/日志</link>
        <description>花生亻 Blog</description>
        <lastBuildDate>Tue, 26 Aug 2025 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-Hans</language>
        <item>
            <title><![CDATA[移除讨厌的打印狗]]></title>
            <link>https://earthnutDev.github.io/日志/2025/8/26/移除打印狗</link>
            <guid>https://earthnutDev.github.io/日志/2025/8/26/移除打印狗</guid>
            <pubDate>Tue, 26 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[在 npm 项目上使用 dog 时发现挺便捷，关键在使用时添加 xxx_dev=all 的启动环境变量，既可以在正式环境也观察到数据流转及发现错误的具体原因。]]></description>
            <content:encoded><![CDATA[<p>在 npm 项目上使用 <a href="https://www.npmjs.com/package/@qqi/log" target="_blank" rel="noopener noreferrer" class="">dog</a> 时发现挺便捷，关键在使用时添加 <code>xxx_dev=all</code> 的启动环境变量，既可以在正式环境也观察到数据流转及发现错误的具体原因。</p>
<p>后来就在 web 项目中使用，发现效果尚可，其实不如 <code>babel</code> 的插件 <code>babel-plugin-transform-remove-console</code> 移除 <code>console</code> 彻底些。</p>
<p>但是，毕竟写了这么包，不用也不太好。主要该包能在函数头位通过设置 <code>type</code> 属性值来判定是否需要打印消息。这样就省去了添加再删除、下次使用时再添加 <code>console.log</code> 的麻烦，且也可以通过过滤器过滤掉。</p>
<!-- -->
<p>在原有的包基础上，又添加了 <a href="https://www.npmjs.com/package/@qqi/babel-plugin-remove-dog-calls" target="_blank" rel="noopener noreferrer" class="">remove dog</a> babel 插件，并搭配着使用 mocks 模拟方法，将 dog 转换成无害的死代码。</p>
<p>其实，一开始还是好的。直到出现了双入口打包的情况。</p>
<p>为了让包 <code>enr</code> 能够在 <code>NextJs</code> 环境下使用，将有状态的组件和无状态的组件进行了分别打包，并在非服务组件的打包头部添加了 <code>use client</code>。但是，在测试时发现了显示 ：</p>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports operator" style="color:#393A34">*</span><span class="token imports"> </span><span class="token imports keyword module" style="color:#00009f">as</span><span class="token imports"> __webpack_chunk_1__</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./dog.mjs'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__webpack_require__</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">C</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__webpack_chunk_1__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> __webpack_exports__ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> __webpack_require__</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">O</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword nil" style="color:#00009f">undefined</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'dog'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">__webpack_require__</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'./index.server.ts'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">__webpack_exports__ </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> __webpack_require__</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">O</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">__webpack_exports__</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> __webpack_exports__EnLayout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> __webpack_exports__</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access maybe-class-name">EnLayout</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>该部分打包报错 <code>Can't read undefined of EnLayout</code>。 因为出错在 <code>dog</code> 包装后，所以判定是 <code>dog</code> 公共方法打包错误引起的。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="使用-babel">使用 babel<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/26/%E7%A7%BB%E9%99%A4%E6%89%93%E5%8D%B0%E7%8B%97#%E4%BD%BF%E7%94%A8-babel" class="hash-link" aria-label="使用 babel的直接链接" title="使用 babel的直接链接" translate="no">​</a></h2>
<p>正如先前构建的包 <a href="https://www.npmjs.com/package/@qqi/babel-plugin-remove-dog-calls" target="_blank" rel="noopener noreferrer" class="">remove dog</a> 一样，在 babel 中引入该包，并根据 <code>process.env</code> 的当前启动环境变量值确定是否加载该插件：</p>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports">process</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'node:process'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">api</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  api</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">cache</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dev_mode</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">??</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'production'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> isProduction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> env </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'production'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">presets</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'@babel/preset-env'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'@babel/preset-react'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string" style="color:#e3116c">'@babel/preset-typescript'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">plugins</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">isProduction </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@qqi/babel-plugin-remove-dog-calls'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">filter</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token known-class-name class-name">Boolean</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>该方法确实是去除了代码结果中的 <code>dog</code> 调用，但打包发现并为完全去除。因为在实际打包的两个文件中还是分别发现了上面的 <code>dog</code> 引用代码，且，当前依旧是显示 <code>EnLayout</code> 无法被访问。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="使用-mocks">使用 mocks<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/26/%E7%A7%BB%E9%99%A4%E6%89%93%E5%8D%B0%E7%8B%97#%E4%BD%BF%E7%94%A8-mocks" class="hash-link" aria-label="使用 mocks的直接链接" title="使用 mocks的直接链接" translate="no">​</a></h2>
<p>一计不成，再想损招。于是想着既然移除了打印，但是还残留 <code>dog</code> 的打包，自然，已经包含着 <code>dog</code> ，但是 <code>dog</code> 本身又引用着 <a href="https://www.npmjs.com/package/@qqi/log" target="_blank" rel="noopener noreferrer" class="">@qqi/log</a> ，相当于还的把 <a href="https://www.npmjs.com/package/@qqi/log" target="_blank" rel="noopener noreferrer" class="">@qqi/log</a> 打包进最后的包或是强制使用该依赖包的项目多安装几个不需要的依赖。嗯，大可不必。</p>
<p>于是，使用 <code>webpack.config.js</code> 配置在打包时，将 <code>resolve.alias</code> 的 <code>@qqi/log</code> 指向它处：</p>
<div class="theme-tabs-container tabs-container tabList_hrDN"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_AVfx tabs__item--active">webpack.config.js</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_AVfx">mocks/log.mjs</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_IU8a"><div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#393A34">{</span><span class="token imports"> join </span><span class="token imports punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'node:path'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">resolve</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">alias</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">'@qqi/log'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword module" style="color:#00009f">import</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">meta</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">dirname</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./mocks/log.mjs'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_IU8a" hidden=""><div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token doc-comment comment" style="color:#999988;font-style:italic">/**  模拟类，用于打包用  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">Dog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token doc-comment comment" style="color:#999988;font-style:italic">/**  模拟类的构建  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">_dev</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setPrototypeOf</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">this</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token known-class-name class-name">Object</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">defineProperties</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">_dev</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">info</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">writable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">warn</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">writable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">error</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token function-variable function" style="color:#d73a49">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#36acaa">writable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">type</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">value</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">configurable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token literal-property property" style="color:#36acaa">writable</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> _dev</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token class-name">Dog</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">prototype</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">clear</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">clear</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div></div></div></div>
<p>然后，打包后发现并为解决 <code>Layout</code> 找不到的问题。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="使用-loader">使用 loader<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/26/%E7%A7%BB%E9%99%A4%E6%89%93%E5%8D%B0%E7%8B%97#%E4%BD%BF%E7%94%A8-loader" class="hash-link" aria-label="使用 loader的直接链接" title="使用 loader的直接链接" translate="no">​</a></h2>
<p>两计不成，继续憋坏。于是想着既然移除了打印，现在组件对 <code>dog</code> 的痕迹也就剩下了 <code>import { dog }  from 'dog';</code>。肯定就是这货捣的乱，于是，决定在 <code>webpack</code> 的 <code>loader</code> 中消灭掉该语句：</p>
<div class="theme-tabs-container tabs-container tabList_hrDN"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_AVfx tabs__item--active">loaders/remove-import-dog.js</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_AVfx">webpack.config.js</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_IU8a"><div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> withDogRegExp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex" style="color:#36acaa">import</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\s</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">+</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\{</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">?</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\s</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">*</span><span class="token regex regex-source language-regex" style="color:#36acaa">dog</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\s</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">*</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\}</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">*</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\s</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">+</span><span class="token regex regex-source language-regex" style="color:#36acaa">from</span><span class="token regex regex-source language-regex char-set class-name" style="color:#36acaa">\s</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">+</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">[</span><span class="token regex regex-source language-regex char-class" style="color:#36acaa">'"</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">]</span><span class="token regex regex-source language-regex" style="color:#36acaa">dog</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">[</span><span class="token regex regex-source language-regex char-class" style="color:#36acaa">'"</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">]</span><span class="token regex regex-source language-regex" style="color:#36acaa">;</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">?</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-flags" style="color:#36acaa">g</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">withDogRegExp</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">source</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> source</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">replace</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">withDogRegExp</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">''</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> source</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div><div role="tabpanel" class="tabItem_IU8a" hidden=""><div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">module</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token literal-property property" style="color:#36acaa">rules</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">test</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token regex regex-source language-regex special-escape escape" style="color:#36acaa">\.</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">[</span><span class="token regex regex-source language-regex char-class" style="color:#36acaa">tj</span><span class="token regex regex-source language-regex char-class char-class-punctuation punctuation" style="color:#393A34">]</span><span class="token regex regex-source language-regex" style="color:#36acaa">sx</span><span class="token regex regex-source language-regex quantifier number" style="color:#36acaa">?</span><span class="token regex regex-source language-regex anchor function" style="color:#d73a49">$</span><span class="token regex regex-delimiter" style="color:#36acaa">/</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">use</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token string" style="color:#e3116c">'./loaders/remove-import-dog.js'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token literal-property property" style="color:#36acaa">loader</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'babel-loader'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token literal-property property" style="color:#36acaa">options</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                </span><span class="token literal-property property" style="color:#36acaa">configFile</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'./babel.config.js'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token spread operator" style="color:#393A34">...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div></div></div>
<p>方法倒是挺好理解，于是，就添加到了 <code>webpack.config.js</code> 。打包，测试（前提是启用了 <a href="https://www.npmjs.com/package/@qqi/babel-plugin-remove-dog-calls" target="_blank" rel="noopener noreferrer" class="">remove dog</a>）,发现没有了 <code>Can't not read undefined of Layout</code>，页面渲染正常。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="病灶">病灶<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/26/%E7%A7%BB%E9%99%A4%E6%89%93%E5%8D%B0%E7%8B%97#%E7%97%85%E7%81%B6" class="hash-link" aria-label="病灶的直接链接" title="病灶的直接链接" translate="no">​</a></h2>
<p>虽然，但是。是吧，是能够正确的渲染了，但是总感觉少点啥。对，少了一天的好心情。</p>
<p>于是，移除 <a href="https://www.npmjs.com/package/@qqi/babel-plugin-remove-dog-calls" target="_blank" rel="noopener noreferrer" class="">remove dog</a>，删除添加的 <code>loader</code>。</p>
<p>在原打包配置下，从压缩后的文件一点点打印日志，在实际的使用中获得了错误：</p>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token template-string string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  Attempted to call __webpack_esm_modules__()</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  from the server but __webpack_esm_modules__ is on the client.</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  It's not possible to invoke a client function from the server,</span><br></span><span class="token-line" style="color:#393A34"><span class="token template-string string" style="color:#e3116c">  it can only be rendered as a Component or passed to props of a Client Component.</span><span class="token template-string template-punctuation string" style="color:#e3116c">`</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p>该错误是由 <code>webpack</code> 在解析接入包时报错，且未显示在控制台，让我一直以为是 <code>dog</code> 没有移除干净导致的。原来是我手动给文件添加 <code>use client</code> 导致被切割的 <code>dog_ts.mjs</code> 文件头也存在了该物，遂导致了差不多耽搁一小天的时间的错误。</p>
<p>冤有头，债有主。</p>
<p>于是找到了 <code>add-use-client-loader.js</code> 文件，正确匹配了该添加 <code>use client</code> 的文件的。于是，耽搁一天的问题才算是真正的得到了解决。</p>
<p>这次的教训无疑的惨痛的，耽搁时间不说，还导致项目拖沓，脑瓜疼。遇事多打“断点”（日志）、少瞎折腾、多想解决方案，少着急上火。</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[布局的学习]]></title>
            <link>https://earthnutDev.github.io/日志/2025/8/22/布局的思考</link>
            <guid>https://earthnutDev.github.io/日志/2025/8/22/布局的思考</guid>
            <pubDate>Fri, 22 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[先写了一个布局，发现，总是在 NextJs 中显示水合错误]]></description>
            <content:encoded><![CDATA[<p>先写了一个布局，发现，总是在 <code>NextJs</code> 中显示水合错误</p>
<p>现在想着使用 <code>FlexBox</code> 或是 <code>Grid</code> 来更改。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="布局结构">布局结构<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/22/%E5%B8%83%E5%B1%80%E7%9A%84%E6%80%9D%E8%80%83#%E5%B8%83%E5%B1%80%E7%BB%93%E6%9E%84" class="hash-link" aria-label="布局结构的直接链接" title="布局结构的直接链接" translate="no">​</a></h2>
<div class="language-html codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">布局结构</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-html codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">body</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">page</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">header</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">header</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">头部</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">header</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">div</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">page-container</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">aside</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">sidebar</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">侧边栏</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">aside</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">main</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">main</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">内容区</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">main</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">div</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">footer</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">class</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag attr-value" style="color:#e3116c">footer</span><span class="token tag attr-value punctuation" style="color:#393A34">"</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">页脚</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">footer</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">body</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="使用-flexbox-弹性布局样式">使用 FlexBox 弹性布局样式<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/22/%E5%B8%83%E5%B1%80%E7%9A%84%E6%80%9D%E8%80%83#%E4%BD%BF%E7%94%A8-flexbox-%E5%BC%B9%E6%80%A7%E5%B8%83%E5%B1%80%E6%A0%B7%E5%BC%8F" class="hash-link" aria-label="使用 FlexBox 弹性布局样式的直接链接" title="使用 FlexBox 弹性布局样式的直接链接" translate="no">​</a></h3>
<p>使用 <code>FlexBox</code> 可以考虑：</p>
<ul>
<li class=""><strong>头部和页脚固定高度</strong>：通过 <code>height</code> 属性固定高度，不随内容变化</li>
<li class=""><strong>侧栏与内容区弹性分配</strong>：<code>page-container</code> 使用 <code>flex: 1</code> 占据剩余空间，<code>sidebar</code> 和 <code>main</code> 分别通过 <code>width</code> 和 <code>flex: 1</code> 分配宽度，高度自动跟随 <code>container</code> 的高度（即视口高度减去头部和页脚高度）</li>
<li class=""><strong>内容过长</strong>：<code>sidebar</code> 和 <code>main</code> 设置 <code>overflow-y: auto</code>，内容过长时内部滚动，避免整体布局被撑开</li>
</ul>
<div class="language-css codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">flex-box.css</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-css codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">/* 重置默认边距 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector" style="color:#00009f">html</span><span class="token selector punctuation" style="color:#393A34">,</span><span class="token selector" style="color:#00009f"></span><br></span><span class="token-line" style="color:#393A34"><span class="token selector" style="color:#00009f">body</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">margin</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token unit">%</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 确保父容器占满视口高度 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.page</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">display</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flex</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">flex-direction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> column</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">min-height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token unit">vh</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 至少占满视口高度 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.header</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">var</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">--header-height</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 头部固定高度 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">background</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hexcode color">#f0f0f0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.page-container</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">display</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> flex</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">flex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 占据剩余所有空间 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> hidden</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 防止内容溢出 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.sidebar</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">width</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">var</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">--sidebar-width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 侧栏固定宽度 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">background</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hexcode color">#e0e0e0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow-y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 内容过长时滚动 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.main</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">flex</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 内容区占据剩余空间 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token unit">rem</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow-y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 内容过长时滚动 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.footer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">var</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">--footer-height</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 页脚固定高度 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">background</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hexcode color">#f0f0f0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="使用-grid-布局精细控制">使用 grid 布局精细控制<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/22/%E5%B8%83%E5%B1%80%E7%9A%84%E6%80%9D%E8%80%83#%E4%BD%BF%E7%94%A8-grid-%E5%B8%83%E5%B1%80%E7%B2%BE%E7%BB%86%E6%8E%A7%E5%88%B6" class="hash-link" aria-label="使用 grid 布局精细控制的直接链接" title="使用 grid 布局精细控制的直接链接" translate="no">​</a></h3>
<p>使用 <code>grid</code> 可以使用自动高度的方式让其精细分配：</p>
<ul>
<li class=""><strong>行高分配</strong>：使用 <code>grid-template-rows: auto 1fr auto</code> 头部（自动高度）、内容区（剩余空间）、页脚（自动高度）</li>
<li class=""><strong>列宽分配</strong>：使用 <code>grid-template-columns</code> 定义侧栏和内容区的宽度，侧栏固定，内容区占据剩余空间</li>
<li class=""><strong>高度分配</strong>：<code>container</code>的高度为 <code>100%</code>（即父容器的 <code>1fr</code> 高度），侧栏和内容区的高度自动同步，避免间隙</li>
</ul>
<div class="language-css codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">grid.css</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-css codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token selector class" style="color:#00009f">.page</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">display</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grid</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">grid-template-rows</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto </span><span class="token number" style="color:#36acaa">1</span><span class="token unit">fr</span><span class="token plain"> auto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 头部（自动高度）、内容区（剩余空间）、页脚（自动高度） */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">min-height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token unit">vh</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.header</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">background</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hexcode color">#f0f0f0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.page-container</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">display</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> grid</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">grid-template-columns</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">var</span><span class="token punctuation" style="color:#393A34">(</span><span class="token variable" style="color:#36acaa">--sidebar-width</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token unit">fr</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 侧栏固定宽度，内容区剩余空间 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">height</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">100</span><span class="token unit">%</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">/* 占据父容器的 1fr 高度 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.sidebar</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">background</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hexcode color">#e0e0e0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow-y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.main</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">padding</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token unit">rem</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">overflow-y</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> auto</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token selector class" style="color:#00009f">.footer</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">background</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token hexcode color">#f0f0f0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[docusaurus 可弹出的组件]]></title>
            <link>https://earthnutDev.github.io/日志/2025/8/21/docusaurus-swizzle</link>
            <guid>https://earthnutDev.github.io/日志/2025/8/21/docusaurus-swizzle</guid>
            <pubDate>Thu, 21 Aug 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[本来觉得没有用，但是英语不好，忽然觉得组件命名上可以借鉴。毕竟，docusaurus 是一款成熟且]]></description>
            <content:encoded><![CDATA[<p>本来觉得没有用，但是英语不好，忽然觉得组件命名上可以借鉴。毕竟，<a href="https://docusaurus.io/zh-CN/docs/swizzling" target="_blank" rel="noopener noreferrer" class="">docusaurus</a> 是一款成熟且</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="警示相关">警示相关<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E8%AD%A6%E7%A4%BA%E7%9B%B8%E5%85%B3" class="hash-link" aria-label="警示相关的直接链接" title="警示相关的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><code>Admonition</code> 劝解、提示<!-- -->
<ul>
<li class=""><code>Icon</code>
<ul>
<li class=""><code>Danger</code> 危险提示图标</li>
<li class=""><code>Info</code> 信息</li>
<li class=""><code>Note</code> 备注</li>
<li class=""><code>Tip</code> 提示</li>
<li class=""><code>Warning</code> 警示、警告</li>
</ul>
</li>
<li class=""><code>Layout</code> 提示的布局</li>
<li class=""><code>Type</code> 提示的类型<!-- -->
<ul>
<li class=""><code>Caution</code> 注意，警告</li>
<li class=""><code>Danger</code> 危险</li>
<li class=""><code>Info</code> 信息</li>
<li class=""><code>Note</code> 备注</li>
<li class=""><code>Tip</code> 提示</li>
<li class=""><code>Warning</code> 警示</li>
</ul>
</li>
<li class=""><code>types</code></li>
</ul>
</li>
<li class="">AnnouncementBar<!-- -->
<ul>
<li class="">CloseButton</li>
<li class="">Content</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="代码块">代码块<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E4%BB%A3%E7%A0%81%E5%9D%97" class="hash-link" aria-label="代码块的直接链接" title="代码块的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><code>CodeBlock</code> 代码块<!-- -->
<ul>
<li class="">Buttons<!-- -->
<ul>
<li class="">Button</li>
<li class="">CopyButton</li>
<li class="">WordWrapButton</li>
</ul>
</li>
<li class="">Container</li>
<li class="">Content<!-- -->
<ul>
<li class="">Element</li>
<li class="">String</li>
</ul>
</li>
<li class="">Layout</li>
<li class="">Line<!-- -->
<ul>
<li class="">Token</li>
</ul>
</li>
<li class="">Title</li>
</ul>
</li>
<li class="">CodeInline</li>
<li class=""><code>ColorModeToggle</code> 暗黑模式切换</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="功能页">功能页<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E5%8A%9F%E8%83%BD%E9%A1%B5" class="hash-link" aria-label="功能页的直接链接" title="功能页的直接链接" translate="no">​</a></h2>
<ul>
<li class="">ErrorPageContent</li>
<li class="">NotFound<!-- -->
<ul>
<li class="">Content</li>
</ul>
</li>
<li class="">SearchMetadata</li>
<li class="">SiteMetadata</li>
<li class="">TOC</li>
<li class="">TOCCollapsible<!-- -->
<ul>
<li class="">CollapseButton</li>
</ul>
</li>
<li class="">TOCInline</li>
<li class="">TOCItems<!-- -->
<ul>
<li class="">Tree</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="功能组件">功能组件<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E5%8A%9F%E8%83%BD%E7%BB%84%E4%BB%B6" class="hash-link" aria-label="功能组件的直接链接" title="功能组件的直接链接" translate="no">​</a></h2>
<ul>
<li class="">Logo</li>
<li class="">EditMetaRow</li>
<li class="">EditThisPage</li>
<li class="">BackToTopButton</li>
<li class="">SkipToContent</li>
<li class="">Mermaid</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="布局">布局<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E5%B8%83%E5%B1%80" class="hash-link" aria-label="布局的直接链接" title="布局的直接链接" translate="no">​</a></h2>
<ul>
<li class="">Layout<!-- -->
<ul>
<li class="">Provider</li>
</ul>
</li>
<li class="">Heading</li>
<li class="">ContentVisibility<!-- -->
<ul>
<li class="">Draft</li>
<li class="">Unlisted</li>
</ul>
</li>
<li class="">Details</li>
<li class="">TabItem</li>
<li class="">Tabs</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="导航栏">导航栏<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E5%AF%BC%E8%88%AA%E6%A0%8F" class="hash-link" aria-label="导航栏的直接链接" title="导航栏的直接链接" translate="no">​</a></h3>
<ul>
<li class="">Navbar<!-- -->
<ul>
<li class="">ColorModeToggle</li>
<li class="">Content</li>
<li class="">Layout</li>
<li class="">Logo</li>
<li class="">MobileSidebar<!-- -->
<ul>
<li class="">Header</li>
<li class="">Layout</li>
<li class="">PrimaryMenu</li>
<li class="">SecondaryMenu</li>
<li class="">Toggle</li>
</ul>
</li>
<li class="">Search</li>
</ul>
</li>
<li class="">NavbarItem<!-- -->
<ul>
<li class="">DefaultNavbarItem<!-- -->
<ul>
<li class="">Desktop</li>
<li class="">Mobile</li>
</ul>
</li>
<li class="">DocNavbarItem</li>
<li class="">DocSidebarNavbarItem</li>
<li class="">DocsVersionDropdownNavbarItem</li>
<li class="">DocsVersionNavbarItem</li>
<li class="">DropdownNavbarItem<!-- -->
<ul>
<li class="">Desktop</li>
<li class="">Mobile</li>
</ul>
</li>
<li class="">HtmlNavbarItem</li>
<li class="">LocaleDropdownNavbarItem</li>
<li class="">NavbarNavLink</li>
<li class="">SearchNavbarItem</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="面包屑">面包屑<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E9%9D%A2%E5%8C%85%E5%B1%91" class="hash-link" aria-label="面包屑的直接链接" title="面包屑的直接链接" translate="no">​</a></h3>
<ul>
<li class="">PaginatorNavLink</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="页脚">页脚<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E9%A1%B5%E8%84%9A" class="hash-link" aria-label="页脚的直接链接" title="页脚的直接链接" translate="no">​</a></h3>
<ul>
<li class="">Footer<!-- -->
<ul>
<li class="">Copyright</li>
<li class="">Layout</li>
<li class="">LinkItem</li>
<li class="">Links<!-- -->
<ul>
<li class="">MultiColumn</li>
<li class="">Simple</li>
</ul>
</li>
<li class="">Logo</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="图标">图标<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E5%9B%BE%E6%A0%87" class="hash-link" aria-label="图标的直接链接" title="图标的直接链接" translate="no">​</a></h2>
<ul>
<li class="">Icon<!-- -->
<ul>
<li class="">Arrow</li>
<li class="">DarkMode</li>
<li class="">Edit</li>
<li class="">LightMode</li>
<li class="">Menu</li>
<li class="">Close</li>
<li class="">Copy</li>
<li class="">ExternalLink</li>
<li class="">Home</li>
<li class="">Language</li>
<li class="">Socials<!-- -->
<ul>
<li class="">Bluesky</li>
<li class="">Default</li>
<li class="">GitHub</li>
<li class="">Instagram</li>
<li class="">LinkedIn</li>
<li class="">Mastodon</li>
<li class="">StackOverflow</li>
<li class="">Threads</li>
<li class="">Twitch</li>
<li class="">Twitter</li>
<li class="">X</li>
<li class="">YouTube</li>
</ul>
</li>
<li class="">Success</li>
<li class="">SystemColorMode</li>
<li class="">WordWrap</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="mdx-文件内容">mdx 文件内容<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#mdx-%E6%96%87%E4%BB%B6%E5%86%85%E5%AE%B9" class="hash-link" aria-label="mdx 文件内容的直接链接" title="mdx 文件内容的直接链接" translate="no">​</a></h2>
<ul>
<li class="">MDXPage</li>
<li class="">MDXContent</li>
<li class="">SearchBar</li>
<li class="">Admonition</li>
<li class="">NavbarItem<!-- -->
<ul>
<li class="">ComponentTypes</li>
</ul>
</li>
<li class="">prism-include-languages</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="mdx-元素默认覆盖">mdx 元素默认覆盖<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#mdx-%E5%85%83%E7%B4%A0%E9%BB%98%E8%AE%A4%E8%A6%86%E7%9B%96" class="hash-link" aria-label="mdx 元素默认覆盖的直接链接" title="mdx 元素默认覆盖的直接链接" translate="no">​</a></h3>
<ul>
<li class="">MDXComponents<!-- -->
<ul>
<li class="">A</li>
<li class="">Code</li>
<li class="">Details</li>
<li class="">Heading</li>
<li class="">Img</li>
<li class="">Pre</li>
<li class="">Ul</li>
<li class="">Li</li>
</ul>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="文档系统">文档系统<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E6%96%87%E6%A1%A3%E7%B3%BB%E7%BB%9F" class="hash-link" aria-label="文档系统的直接链接" title="文档系统的直接链接" translate="no">​</a></h2>
<ul>
<li class="">DocBreadcrumbs<!-- -->
<ul>
<li class="">Items<!-- -->
<ul>
<li class="">Home</li>
</ul>
</li>
<li class="">StructuredData</li>
</ul>
</li>
<li class="">DocCard</li>
<li class="">DocCategoryGeneratedIndexPage</li>
<li class="">DocItem<!-- -->
<ul>
<li class="">Content</li>
<li class="">Footer</li>
<li class="">Layout</li>
<li class="">Metadata</li>
<li class="">Paginator</li>
<li class="">TOC<!-- -->
<ul>
<li class="">Desktop</li>
<li class="">Mobile</li>
</ul>
</li>
</ul>
</li>
<li class=""><code>DocCardList</code> 文档卡片列表</li>
<li class="">DocPaginator</li>
<li class="">DocRoot<!-- -->
<ul>
<li class="">Layout<!-- -->
<ul>
<li class="">Main</li>
<li class="">Sidebar<!-- -->
<ul>
<li class="">ExpandButton</li>
</ul>
</li>
</ul>
</li>
<li class="">Desktop<!-- -->
<ul>
<li class="">CollapseButton</li>
<li class="">Content</li>
</ul>
</li>
<li class="">Mobile</li>
</ul>
</li>
<li class="">DocSidebar</li>
<li class="">DocSidebarItem<!-- -->
<ul>
<li class="">Category</li>
<li class="">Html</li>
<li class="">Link</li>
</ul>
</li>
<li class="">DocSidebarItems</li>
<li class="">DocTagDocListPage</li>
<li class="">DocTagsListPage</li>
<li class="">DocVersionBadge</li>
<li class="">DocVersionBanner</li>
<li class="">DocVersionRoot</li>
<li class="">DocsRoot</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="博客相关">博客相关<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E5%8D%9A%E5%AE%A2%E7%9B%B8%E5%85%B3" class="hash-link" aria-label="博客相关的直接链接" title="博客相关的直接链接" translate="no">​</a></h2>
<ul>
<li class="">Blog<!-- -->
<ul>
<li class="">Components<!-- -->
<ul>
<li class="">Author<!-- -->
<ul>
<li class="">Socials</li>
</ul>
</li>
</ul>
</li>
<li class="">Pages<!-- -->
<ul>
<li class="">BlogAuthorsListPage</li>
<li class="">BlogAuthorsPostsPage</li>
</ul>
</li>
</ul>
</li>
<li class="">BlogArchivePage</li>
<li class="">BlogLayout</li>
<li class="">BlogListPage<!-- -->
<ul>
<li class="">StructuredData</li>
</ul>
</li>
<li class="">BlogListPaginator</li>
<li class="">BlogPostItem<!-- -->
<ul>
<li class="">Container</li>
<li class="">Content</li>
<li class="">Footer<!-- -->
<ul>
<li class="">ReadMoreLink</li>
</ul>
</li>
<li class="">Header<!-- -->
<ul>
<li class="">Authors</li>
<li class="">Info</li>
<li class="">Title</li>
</ul>
</li>
</ul>
</li>
<li class="">BlogPostItems</li>
<li class="">BlogPostPage<!-- -->
<ul>
<li class="">Metadata</li>
<li class="">StructuredData</li>
</ul>
</li>
<li class="">BlogPostPaginator</li>
<li class="">LastUpdated</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="博文侧栏">博文侧栏<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E5%8D%9A%E6%96%87%E4%BE%A7%E6%A0%8F" class="hash-link" aria-label="博文侧栏的直接链接" title="博文侧栏的直接链接" translate="no">​</a></h3>
<ul>
<li class="">
<p>BlogSidebar</p>
<ul>
<li class="">Content</li>
<li class="">Desktop</li>
<li class="">Mobile</li>
</ul>
</li>
<li class="">
<p>BlogTagsListPage</p>
</li>
<li class="">
<p>BlogTagsPostsPage</p>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="博客标签">博客标签<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/2025/8/21/docusaurus-swizzle#%E5%8D%9A%E5%AE%A2%E6%A0%87%E7%AD%BE" class="hash-link" aria-label="博客标签的直接链接" title="博客标签的直接链接" translate="no">​</a></h3>
<ul>
<li class="">Tag</li>
<li class="">TagsListByLetter</li>
<li class="">TagsListInline</li>
<li class="">ThemeProvider<!-- -->
<ul>
<li class="">TitleFormatter</li>
</ul>
</li>
<li class="">ThemedImage</li>
</ul>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[await 也需要 catch]]></title>
            <link>https://earthnutDev.github.io/日志/报错就报错，为什么是 triggerUncaughtException</link>
            <guid>https://earthnutDev.github.io/日志/报错就报错，为什么是 triggerUncaughtException</guid>
            <pubDate>Sun, 18 May 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[正确使用 try...catch 可加强]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorTargetStickyNavbar_e79m" id="总把外行当内行遇见问题总抓狂">总把外行当内行，遇见问题总抓狂<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8A%A5%E9%94%99%E5%B0%B1%E6%8A%A5%E9%94%99%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%20triggerUncaughtException#%E6%80%BB%E6%8A%8A%E5%A4%96%E8%A1%8C%E5%BD%93%E5%86%85%E8%A1%8C%E9%81%87%E8%A7%81%E9%97%AE%E9%A2%98%E6%80%BB%E6%8A%93%E7%8B%82" class="hash-link" aria-label="总把外行当内行，遇见问题总抓狂的直接链接" title="总把外行当内行，遇见问题总抓狂的直接链接" translate="no">​</a></h2>
<p>不记得在哪里看了这么一句话：“在 js 中尽量不写 <code>try...catch</code> ，因为会拖累进程，甚至拖垮程序。每一个 <code>try..catch</code> 都将创建一个独立的内存，需要先执行一遍，然后看一下有没有错误，没有错误再返回源执行栈事件进行执行。“</p>
<p>当时，看见这句话，若获珍宝。巴不得在自己的项目中可以一个 <code>try...catch</code> 没有，也不能造成性能不足。</p>
<p><em>直到</em>，昨晚一个小时一点点的打印找关于 <code>triggerUncaughtException</code> 的错，才发现，这真是“外行看热闹，内行看门道。半瓶子看自以为是和瞎几把信外行的瞎几把说”。</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="性能关键结论">性能关键结论​<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8A%A5%E9%94%99%E5%B0%B1%E6%8A%A5%E9%94%99%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%20triggerUncaughtException#%E6%80%A7%E8%83%BD%E5%85%B3%E9%94%AE%E7%BB%93%E8%AE%BA" class="hash-link" aria-label="性能关键结论​的直接链接" title="性能关键结论​的直接链接" translate="no">​</a></h2>
<table><thead><tr><th style="text-align:left">场景</th><th style="text-align:left">性能影响</th><th style="text-align:left">数据参考 (V8 引擎)</th></tr></thead><tbody><tr><td style="text-align:left">​​无异常的 try/catch</td><td style="text-align:left">几乎无损耗（ &lt;1% 差异）</td><td style="text-align:left">每秒执行 1 亿次无感知</td></tr><tr><td style="text-align:left">​​高频抛出异常​​</td><td style="text-align:left">显著下降（10~100 倍）</td><td style="text-align:left">每秒处理异常 ≤1 万次</td></tr><tr><td style="text-align:left">​​嵌套 try/catch</td><td style="text-align:left">作用域管理有轻微损耗</td><td style="text-align:left">单层 vs 五层损耗差约 5%</td></tr></tbody></table>
<p><strong>正确性 &gt;&gt; 性能</strong>​​：牺牲 1% 性能换取健壮的错误处理是值得的。只有对性能极其敏感的核心模块（如游戏引擎、高频交易系统），才需要抠 try/catch 的细节。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="引擎优化原理">引擎优化原理​<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8A%A5%E9%94%99%E5%B0%B1%E6%8A%A5%E9%94%99%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%20triggerUncaughtException#%E5%BC%95%E6%93%8E%E4%BC%98%E5%8C%96%E5%8E%9F%E7%90%86" class="hash-link" aria-label="引擎优化原理​的直接链接" title="引擎优化原理​的直接链接" translate="no">​</a></h2>
<ol>
<li class=""><strong>无异常路径的「快速通道」​​</strong>
V8 会对未触发异常的 try 代码块做内联缓存优化（Inline Caching），跳过异常监控逻辑。
类似 if/else 的​​预测执行机制​​，不影响主线程性能。</li>
<li class=""><strong>​​仅当 throw 时触发「慢速路径」​​</strong>
异常对象需要生成堆栈跟踪（Stack Trace），消耗 CPU。
垃圾回收压力增大（频繁创建/销毁 Error 对象）。</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="极端场景性能陷阱">极端场景性能陷阱​<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8A%A5%E9%94%99%E5%B0%B1%E6%8A%A5%E9%94%99%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%20triggerUncaughtException#%E6%9E%81%E7%AB%AF%E5%9C%BA%E6%99%AF%E6%80%A7%E8%83%BD%E9%99%B7%E9%98%B1" class="hash-link" aria-label="极端场景性能陷阱​的直接链接" title="极端场景性能陷阱​的直接链接" translate="no">​</a></h2>
<ol>
<li class="">高频异常抛出（灾难级性能）​</li>
</ol>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ❌ 错误用法：将异常用于正常控制流</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">num </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">throw</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'Negative'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ✅ 优化方案：用条件判断代替异常</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> num </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>性能对比​​</strong>：改用条件判断后，速度提升 ​​50~100 倍​​。2. ​​热代码路径中的冗余 try/catch</p>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// ❌ 不必要的 try/catch 包裹循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 高频执行代码</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// ✅ 将 try/catch 移出循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword control-flow" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1e6</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i</span><span class="token operator" style="color:#393A34">++</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">/* 单次操作 */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#00009f">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>性能对比​​</strong>：外层包裹导致引擎无法优化，速度下降 ​​5~10%​​。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="建议">建议<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8A%A5%E9%94%99%E5%B0%B1%E6%8A%A5%E9%94%99%EF%BC%8C%E4%B8%BA%E4%BB%80%E4%B9%88%E6%98%AF%20triggerUncaughtException#%E5%BB%BA%E8%AE%AE" class="hash-link" aria-label="建议的直接链接" title="建议的直接链接" translate="no">​</a></h2>
<ol>
<li class=""><strong>必要错误处理</strong>​​：对数据库、网络请求、文件 IO 等​​异步操作必须用 try/catch。</li>
<li class=""><strong>避免异常滥用</strong>​​：​​不要用 throw 替代条件判断​​（如参数校验）。</li>
<li class=""><strong>全局兜底​</strong>​：用 process.on('unhandledRejection') 或 window.onerror 捕获漏网之鱼。</li>
<li class=""><strong>性能敏感场景</strong>​​：对高频执行的数学计算、排序算法等，优先用 if 防御而非 try。</li>
</ol>]]></content:encoded>
            <category>npm 包</category>
        </item>
        <item>
            <title><![CDATA[终端虽好，理性待之]]></title>
            <link>https://earthnutDev.github.io/日志/mac 终端的囧事</link>
            <guid>https://earthnutDev.github.io/日志/mac 终端的囧事</guid>
            <pubDate>Sat, 17 May 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用 mac 终端导致的笑话]]></description>
            <content:encoded><![CDATA[<p>不想说，说了都是泪。</p>
<p>在写 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 的时候，有一件事贼尴尬。</p>
<p>写好了之后，在发布新版本后在 <a href="https://www.npmjs.com/package/vjj" target="_blank" rel="noopener noreferrer" class="">vjj</a>（使用的是 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 的 <code>question</code> 和 <code>select</code>） 中使用时，发现测试时总是第三次就会出现打印残影。于是翻箱倒柜问国产 ai，回答都是一致的“在使用 <code>emitKeypressEvents</code> 的时候没有清理导致的残余”。</p>
<p>在 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 的每一次测试都没有问题，一到了 <a href="https://www.npmjs.com/package/vjj" target="_blank" rel="noopener noreferrer" class="">vjj</a> 上就会出现这个问题。</p>
<p>首先声明：我的代码逻辑能力很强，这个不是代码逻辑或残余事件监听导致的</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="寻求五大家族的帮助">寻求五大家族的帮助<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/mac%20%E7%BB%88%E7%AB%AF%E7%9A%84%E5%9B%A7%E4%BA%8B#%E5%AF%BB%E6%B1%82%E4%BA%94%E5%A4%A7%E5%AE%B6%E6%97%8F%E7%9A%84%E5%B8%AE%E5%8A%A9" class="hash-link" aria-label="寻求五大家族的帮助的直接链接" title="寻求五大家族的帮助的直接链接" translate="no">​</a></h2>
<p>五大家族（<a href="https://www.tongyi.com/qianwen/" target="_blank" rel="noopener noreferrer" class="">通义千问</a>、<a href="https://www.doubao.com/chat/" target="_blank" rel="noopener noreferrer" class="">字节豆包</a>、<a href="https://yuanbao.tencent.com/chat/naQivTmsDa" target="_blank" rel="noopener noreferrer" class="">腾讯元宝</a>、<a href="https://yiyan.baidu.com/" target="_blank" rel="noopener noreferrer" class="">百度一言</a>、<a href="https://chat.deepseek.com/" target="_blank" rel="noopener noreferrer" class=""><code>传说 ds</code></a>）回答基本上没有啥区别。无非是在前两次积攒的未清理的绑定事件没有及时清理导致后面的第三次毕现 bug。</p>
<p>神奇的是在 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a>中却不会出现该故障，无论多少次测试都是一致的效果。</p>
<p>硬控一天，你懂不懂。真的是硬控一天。</p>
<p>而且该故障在使用 mac 终端时会在调试 <a href="https://www.npmjs.com/package/vjj" target="_blank" rel="noopener noreferrer" class="">vjj</a> 第三（必须是干净的从新打开的终端）次时必现，而在 vscode 中则没有该故障。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="初见端倪">初见端倪<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/mac%20%E7%BB%88%E7%AB%AF%E7%9A%84%E5%9B%A7%E4%BA%8B#%E5%88%9D%E8%A7%81%E7%AB%AF%E5%80%AA" class="hash-link" aria-label="初见端倪的直接链接" title="初见端倪的直接链接" translate="no">​</a></h2>
<p>从该功能的根依赖 <a href="https://www.npmjs.com/package/a-node-tools" target="_blank" rel="noopener noreferrer" class="">a-node-tools</a> 到 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 再到 <a href="https://www.npmjs.com/package/vjj" target="_blank" rel="noopener noreferrer" class="">vjj</a> ，最后没办法，做最小单元测试、功能测试，都无没有效果。</p>
<p>直到，不小心拉长了 mac 自带终端。发现，第三次毕现的问题居然在第五次才出现！！！</p>
<p>咦，那要是这么说的话，我一直在找的未清理的事件监听它不存在。他有可能是终端长度（行数，<code>process.stdout.rows</code>）的问题。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="找到问题解决问题">找到问题，解决问题<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/mac%20%E7%BB%88%E7%AB%AF%E7%9A%84%E5%9B%A7%E4%BA%8B#%E6%89%BE%E5%88%B0%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E9%97%AE%E9%A2%98" class="hash-link" aria-label="找到问题，解决问题的直接链接" title="找到问题，解决问题的直接链接" translate="no">​</a></h2>
<p>其实，在 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 的 <code>2.1.9</code> 版本之前是没有这个问题的，之前是采用打印记行数的逻辑，统计打印的行数，然后在输出内容后直接使用 <a href="https://www.npmjs.com/package/a-node-tools" target="_blank" rel="noopener noreferrer" class="">a-node-tools</a> 中的 <code>cursorModeUp</code> 将光标手动移动到上一次打印该问题的位置，然后进行打印清理（调用 <a href="https://www.npmjs.com/package/a-node-tools" target="_blank" rel="noopener noreferrer" class="">a-node-tools</a> 的 <code>cursorAfterClean</code>），之后再打印新内容，看起来就像是交互的问答或是选择。</p>
<p>后来，在 <a href="https://www.npmjs.com/package/a-node-tools" target="_blank" rel="noopener noreferrer" class="">a-node-tools</a> 中添加了 <code>cursorPositionSave</code> 和 <code>cursorPositionUndo</code> 来储存光标位置和释放光标的位置。</p>
<p>在 mac 的终端上出现问题因为在全新页面的终端，使用 <code>cursorPositionSave</code> 记录的是可视区域的光标位置，如果剩余的空间不足以打印将打印的内容，保存的位置是打印前的原位置，而实际在打印后，想打印的位置被顶到到了上面，使用 <code>cursorPositionUndo</code> 时恢复的是最后保存的光标位置，而不是实际的位置。</p>
<p>在 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 的测试中每次都没有问题是因为每次执行 <code>npm test</code> 时，该钩子中有 <code>jja cls</code> 清理了旧的缓冲区，每次都是新的。</p>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"jja rm .eg cls &amp;&amp; npm run dev"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="解决方案">解决方案<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/mac%20%E7%BB%88%E7%AB%AF%E7%9A%84%E5%9B%A7%E4%BA%8B#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" class="hash-link" aria-label="解决方案的直接链接" title="解决方案的直接链接" translate="no">​</a></h2>
<p>在下一版的 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 中做出应对方案，包括不限于监听终端尺寸变化时清理终端、终端尺寸不足渲染时提醒拉大尺寸、在 mac 终端保存光标前</p>]]></content:encoded>
            <category>npm 包</category>
        </item>
        <item>
            <title><![CDATA[光标，你肿么了？怎么不见了]]></title>
            <link>https://earthnutDev.github.io/日志/node 退出事件</link>
            <guid>https://earthnutDev.github.io/日志/node 退出事件</guid>
            <pubDate>Mon, 12 May 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用  ANSI 转义码]]></description>
            <content:encoded><![CDATA[<p>在编写 <a href="https://www.npmjs.com/package/a-node-tools" target="_blank" rel="noopener noreferrer" class="">a-node-tools</a> 的 runOtherCode 模块时，使用 <code>process.on('exit', cursorShow)</code> 监听事件流中断，期望在程序退出时将隐藏的光标展示出来。然而，在实际的使用中，难遂人愿。</p>
<p>在实际的运行中，在遇到 <code>Ctrl + C</code> 的这种意外事件时，触发的是 <code>SIGINT</code> 信号，触发了 <code>process.on('SIGINT'，()=&gt;{})</code></p>
<!-- -->
<p>所以，在事件的退出时，仅注册了 <code>process.on('exit', cursorShow)</code> 并没有得到想要的结果。</p>
<p>如果仅是如此，直接将 <code>cursorShow</code> 事件作为 <code>SIGINT</code> 的回调不就完事。但，这件事没这么简单。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="为什么可以在-a-command-中可用">为什么可以在 <code>a-command</code> 中可用？<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E9%80%80%E5%87%BA%E4%BA%8B%E4%BB%B6#%E4%B8%BA%E4%BB%80%E4%B9%88%E5%8F%AF%E4%BB%A5%E5%9C%A8-a-command-%E4%B8%AD%E5%8F%AF%E7%94%A8" class="hash-link" aria-label="为什么可以在-a-command-中可用的直接链接" title="为什么可以在-a-command-中可用的直接链接" translate="no">​</a></h2>
<p>在之前的版本中，并没有等待提示的打印。后来添加了等待后，从该包的下游产品 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 摘取了这一段代码</p>
<div class="language-ts codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-ts codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> cursorShow </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'../cursor'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'exit'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cursorShow</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<p>在 <a href="https://www.npmjs.com/package/a-command" target="_blank" rel="noopener noreferrer" class="">a-command</a> 中使用该段代码能够在 <code>question</code> 和 <code>selection</code> 模块执行时正确的退出程序，而移动到 <a href="https://www.npmjs.com/package/a-node-tools" target="_blank" rel="noopener noreferrer" class="">a-node-tools</a> 却上演了罢工潮。所以，一定是哪里处理问题。</p>
<p>在 <a href="https://nodejs.org/docs/latest/api/process.html#process-events" target="_blank" rel="noopener noreferrer" class="">node 官方文档中</a> 的信号事件中对该信号值触发进行了讲解。</p>
<p><code>SIGINT</code> 是比较常用的一个手动退出的信号消息，该消息直接触发退出程序，它就是大名鼎鼎的 <code>Ctrl</code> + <code>C</code>。也是导致 <a href="https://www.npmjs.com/package/a-node-tools" target="_blank" rel="noopener noreferrer" class="">a-node-tools</a> 在退出前没有执行 'exit' 的信号事件监听。</p>
<p>原则上，没有监听 <code>Ctrl</code> + <code>C</code> node 将直接中止进程。</p>
<p>而在实际的使用中，可以监听信号事件 <code>SIGINT</code> 来自定义接收信号的动作。而这，将直接覆盖原 node 在接收该信号后的退出。</p>
<p>现在想要在程序意外接收用户的主动退出信号 <code>Ctrl</code> + <code>C</code> ,则必须监听 <code>SIGINT</code> 信号事件：</p>
<div class="language-ts codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-ts codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> cursorShow </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'../cursor'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'exit'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> cursorShow</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">'SIGINT'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">cursorShow</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 意外退出时恢复光标的展示</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">exit</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 退出程序，该命令会再次触发 process.on('exit') 上绑定事件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="退出码">退出码<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E9%80%80%E5%87%BA%E4%BA%8B%E4%BB%B6#%E9%80%80%E5%87%BA%E7%A0%81" class="hash-link" aria-label="退出码的直接链接" title="退出码的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="sigterm">SIGTERM<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E9%80%80%E5%87%BA%E4%BA%8B%E4%BB%B6#sigterm" class="hash-link" aria-label="SIGTERM的直接链接" title="SIGTERM的直接链接" translate="no">​</a></h3>
<p>当进程接收到SIGTERM信号时触发。这个信号通常是由系统或其他进程发送给当前进程，用于请求进程正常终止。与SIGINT类似，它也是一种常见的用于终止进程的信号，但SIGINT通常是由用户通过终端输入（如Ctrl + C）产生，而SIGTERM更多是由外部系统或进程发出的终止请求。可以通过process.on('SIGTERM', () =&gt; <!-- -->)来监听该事件。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="uncaughtexception">uncaughtException<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E9%80%80%E5%87%BA%E4%BA%8B%E4%BB%B6#uncaughtexception" class="hash-link" aria-label="uncaughtException的直接链接" title="uncaughtException的直接链接" translate="no">​</a></h3>
<p>当一个未捕获的异常在事件循环中冒泡到最顶层时触发。如果不处理这个事件，Node.js 会打印出异常堆栈信息并退出进程。可以使用process.on('uncaughtException', (err) =&gt; <!-- -->)来监听该事件，在回调函数中可以进行一些紧急的错误处理，比如记录错误日志、尝试进行一些清理操作等，但不建议在这个事件中进行复杂的异步操作，因为进程可能会在这个事件处理完后立即退出。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="unhandledrejection">unhandledRejection<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E9%80%80%E5%87%BA%E4%BA%8B%E4%BB%B6#unhandledrejection" class="hash-link" aria-label="unhandledRejection的直接链接" title="unhandledRejection的直接链接" translate="no">​</a></h3>
<p>当一个 Promise 被拒绝且没有被catch块捕获时触发。这通常表示在异步操作中出现了错误，但没有进行适当的错误处理。可以通过process.on('unhandledRejection', (reason, promise) =&gt; <!-- -->)来监听该事件，在回调函数中可以记录错误信息或采取一些补救措施。与uncaughtException不同，unhandledRejection不会导致进程立即退出，而是会在事件循环的下一个 tick 继续执行，这给了开发者更多的时间来处理未处理的 Promise 拒绝情况。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="beforeexit">beforeExit<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E9%80%80%E5%87%BA%E4%BA%8B%E4%BB%B6#beforeexit" class="hash-link" aria-label="beforeExit的直接链接" title="beforeExit的直接链接" translate="no">​</a></h3>
<p>在exit事件之前触发，当 Node.js 检测到没有其他工作要做，准备退出事件循环时会触发这个事件。可以使用process.on('beforeExit', (code) =&gt; <!-- -->)来监听该事件，在回调函数中可以执行一些最后的清理操作，但需要注意的是，如果在beforeExit事件处理函数中启动了新的异步操作，可能会导致进程无法正常退出，因为beforeExit事件只是在检查是否可以退出时触发，而不是在确定要退出时触发。</p>]]></content:encoded>
            <category>npm 包</category>
        </item>
        <item>
            <title><![CDATA[ANSI 转义码]]></title>
            <link>https://earthnutDev.github.io/日志/ANSI 转义码</link>
            <guid>https://earthnutDev.github.io/日志/ANSI 转义码</guid>
            <pubDate>Tue, 22 Apr 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用  ANSI 转义码]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorTargetStickyNavbar_e79m" id="类别">类别<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E7%B1%BB%E5%88%AB" class="hash-link" aria-label="类别的直接链接" title="类别的直接链接" translate="no">​</a></h2>
<p>转义码主要用于控制终端的输出行为，有四个基本类别：</p>
<ul>
<li class="">光标：允许操控屏幕上光标的：移动、显隐、滚动限制、部分屏幕的使用</li>
<li class="">属性：设置或清除文本的属性</li>
<li class="">颜色：更改当前文本的前景色和背景色</li>
<li class="">其他转义：清除屏幕、清除屏幕部分、重置终端、设置制表符</li>
</ul>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="一些-ansi-转义序列">一些 ANSI 转义序列<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E4%B8%80%E4%BA%9B-ansi-%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97" class="hash-link" aria-label="一些 ANSI 转义序列的直接链接" title="一些 ANSI 转义序列的直接链接" translate="no">​</a></h2>
<table><thead><tr><th style="text-align:left">序列</th><th style="text-align:left">名称</th><th style="text-align:left">作用</th></tr></thead><tbody><tr><td style="text-align:left"><code>\eN</code></td><td style="text-align:left">SS2 - Single Shift Two</td><td style="text-align:left">从其中一个代替的字符集选择一个字集</td></tr><tr><td style="text-align:left"><code>\eO</code></td><td style="text-align:left">SS3 - Single Shift Three</td><td style="text-align:left">同上</td></tr><tr><td style="text-align:left"><code>\eP</code></td><td style="text-align:left">DCS - 设备控制字符串</td><td style="text-align:left">控制设备。在 xterm 中，该序列的使用包括定义用户的自定义密钥，以及请求或设置 Termcap/Terminfo 数据</td></tr><tr><td style="text-align:left"><code>\e[</code></td><td style="text-align:left">CSI - 控制序列导入器</td><td style="text-align:left">大部分有用的序列，参阅下面的光标、颜色、滚动</td></tr><tr><td style="text-align:left"><code>\e\</code></td><td style="text-align:left">ST - 结束字符串</td><td style="text-align:left">终止其他控件（包括 APC、DCS、OSC、PM 和 SOS ）中的字符串</td></tr><tr><td style="text-align:left"><code>\e]</code></td><td style="text-align:left">OSC - 操作系统命令</td><td style="text-align:left">启动操作系统使用的控制字符串。 OSC 和 CSI 序列相似，但不限于整数参数</td></tr><tr><td style="text-align:left"><code>\eX</code></td><td style="text-align:left">SOS - 字符串开始</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>\e^</code></td><td style="text-align:left">PM - 私有消息</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>\e_</code></td><td style="text-align:left">APC - 应用程序命令</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><code>\ec</code></td><td style="text-align:left">RIS - 重置为初始状态</td><td style="text-align:left">将设备重置为原始状态。可能包括（如果适用的话）：重置图形格式，清除制表符，重置为默认字体等等。</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="光标和滚动转义序列">光标和滚动转义序列<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%85%89%E6%A0%87%E5%92%8C%E6%BB%9A%E5%8A%A8%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97" class="hash-link" aria-label="光标和滚动转义序列的直接链接" title="光标和滚动转义序列的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="光标显隐">光标显隐<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%85%89%E6%A0%87%E6%98%BE%E9%9A%90" class="hash-link" aria-label="光标显隐的直接链接" title="光标显隐的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">在 shell 脚本使用 <code>tput xx </code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>tivis</code> (注意 ⚠️ ： Terminal 的条目不支持)</td><td style="text-align:center"><code>\e[?25l</code></td><td style="text-align:left">隐藏光标</td></tr><tr><td style="text-align:left"><code>tvvis</code> （注意 ⚠️ ： Terminal 的条目不支持）</td><td style="text-align:center"><code>\e[?25h</code></td><td style="text-align:left">显示光标</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="光标位置设置">光标位置设置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%85%89%E6%A0%87%E4%BD%8D%E7%BD%AE%E8%AE%BE%E7%BD%AE" class="hash-link" aria-label="光标位置设置的直接链接" title="光标位置设置的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">在 shell 脚本使用 <code>tput xx </code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>cup r c</code></td><td style="text-align:center"><code>\e[r;c;H</code></td><td style="text-align:left">光标设置到 r 行 c 列</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[6n</code></td><td style="text-align:left">报告光标位置（shell 脚本不支持）</td></tr><tr><td style="text-align:left"><code>sc</code></td><td style="text-align:center"><code>\e7</code> 或 <code>\e[s</code></td><td style="text-align:left">保存当前光标的位置 (wiki 百科说 <code>\e[s</code> 也可以，在我的 mac 不可用)</td></tr><tr><td style="text-align:left"><code>rc</code></td><td style="text-align:center"><code>\e8</code> 或 <code>\e[u</code></td><td style="text-align:left">恢复当前光标的位置 (wiki 百科说 <code>\e[u</code> 也可以，在我的 mac 不可用)</td></tr><tr><td style="text-align:left"><code>cuu r</code></td><td style="text-align:center"><code>\e[rA</code></td><td style="text-align:left">光标向上 r 行</td></tr><tr><td style="text-align:left"><code>cud r</code></td><td style="text-align:center"><code>\e[rB</code></td><td style="text-align:left">光标向下 r 行</td></tr><tr><td style="text-align:left"><code>cuf c</code></td><td style="text-align:center"><code>\e[cC</code></td><td style="text-align:left">光标向右 c 列</td></tr><tr><td style="text-align:left"><code>cub c</code></td><td style="text-align:center"><code>\e[cD</code></td><td style="text-align:left">光标向左 c 列</td></tr><tr><td style="text-align:left"><code>cnl c</code></td><td style="text-align:center"><code>\e[cE</code></td><td style="text-align:left">光标向下 c 列（默认 1）的开头</td></tr><tr><td style="text-align:left"><code>cha c</code></td><td style="text-align:center"><code>\e[cF</code></td><td style="text-align:left">光标向上 c 列（默认 1）的开头</td></tr><tr><td style="text-align:left"><code>el n</code></td><td style="text-align:center"><code>\e[nS</code></td><td style="text-align:left">整页向上滚动，新行添加到底部</td></tr><tr><td style="text-align:left"><code>su n</code></td><td style="text-align:center"><code>\e[nT</code></td><td style="text-align:left">整页向下滚动，新行添加到顶部</td></tr><tr><td style="text-align:left"><code>hvp r c</code></td><td style="text-align:center"><code>\e[r;cF</code></td><td style="text-align:left">光标位置设定，同 <code>cup</code></td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[?7l</code></td><td style="text-align:left">当光标达到屏幕的右边缘时禁用自动换行</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[?7h</code></td><td style="text-align:left">启用换行</td></tr><tr><td style="text-align:left"><code>do</code></td><td style="text-align:center"><code>\eD</code></td><td style="text-align:left">将光标向下移动一行</td></tr><tr><td style="text-align:left"><code>up</code></td><td style="text-align:center"><code>\eM</code></td><td style="text-align:left">将光标向上移动一行</td></tr><tr><td style="text-align:left">``</td><td style="text-align:center">``</td><td style="text-align:left"></td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="屏幕滚动行为">屏幕滚动行为<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%B1%8F%E5%B9%95%E6%BB%9A%E5%8A%A8%E8%A1%8C%E4%B8%BA" class="hash-link" aria-label="屏幕滚动行为的直接链接" title="屏幕滚动行为的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">在 shell 脚本使用 <code>tput xx </code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[r</code></td><td style="text-align:left">启用全屏滚动</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[S;Er</code></td><td style="text-align:left">启用从 S 行到 E 行的屏幕部分滚动，并将光标移动到此区域的顶部</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="属性和颜色转义序列">属性和颜色转义序列<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%B1%9E%E6%80%A7%E5%92%8C%E9%A2%9C%E8%89%B2%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97" class="hash-link" aria-label="属性和颜色转义序列的直接链接" title="属性和颜色转义序列的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="重置属性">重置属性<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E9%87%8D%E7%BD%AE%E5%B1%9E%E6%80%A7" class="hash-link" aria-label="重置属性的直接链接" title="重置属性的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>me</code></td><td style="text-align:center"><code>\e[m</code> 或 <code>\e[0m</code></td><td style="text-align:left">将所有属性重置为默认值</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="属性设置">属性设置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%B1%9E%E6%80%A7%E8%AE%BE%E7%BD%AE" class="hash-link" aria-label="属性设置的直接链接" title="属性设置的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>bold</code></td><td style="text-align:center"><code>\e[1m</code></td><td style="text-align:left">启用粗文本显示</td></tr><tr><td style="text-align:left"><code>dim</code></td><td style="text-align:center"><code>\e[2m</code></td><td style="text-align:left">启用浅文本显示</td></tr><tr><td style="text-align:left"><code>so</code></td><td style="text-align:center"><code>\e[3m</code></td><td style="text-align:left">启用突出显示，在终端不受支持</td></tr><tr><td style="text-align:left"><code>us</code></td><td style="text-align:center"><code>\e[4m</code></td><td style="text-align:left">启用下划线文本显示</td></tr><tr><td style="text-align:left"><code>blink</code> （部分终端不支持）</td><td style="text-align:center"><code>\e[5m</code></td><td style="text-align:left">闪烁</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[6m</code></td><td style="text-align:left">快速闪烁或删除线（终端不支持）</td></tr><tr><td style="text-align:left"><code>mr</code></td><td style="text-align:center"><code>\e[7m</code></td><td style="text-align:left">启用反向显示</td></tr><tr><td style="text-align:left"><code>invis</code></td><td style="text-align:center"><code>\e[8m</code></td><td style="text-align:left">启用隐藏文本</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[9m</code></td><td style="text-align:left">闲置 (部分设备上为删除线)</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[10 - 19m</code></td><td style="text-align:left">字体选择，大部分终端不支持</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="清除属性">清除属性<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E6%B8%85%E9%99%A4%E5%B1%9E%E6%80%A7" class="hash-link" aria-label="清除属性的直接链接" title="清除属性的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[20m</code></td><td style="text-align:left">"Fraktur"（尖角体）字体，大部分终端并不支持</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[21m</code></td><td style="text-align:left">闲置</td></tr><tr><td style="text-align:left"><code>se</code></td><td style="text-align:center"><code>\e[22m</code></td><td style="text-align:left">禁用粗文本、浅文本显示</td></tr><tr><td style="text-align:left"><code>se</code></td><td style="text-align:center"><code>\e[23m</code></td><td style="text-align:left">禁用突出显示</td></tr><tr><td style="text-align:left"><code>ue</code></td><td style="text-align:center"><code>\e[24m</code></td><td style="text-align:left">禁用带下划线的显示</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[25m</code></td><td style="text-align:left">禁用闪烁和删除线</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[26m</code></td><td style="text-align:left">闲置</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[27m</code></td><td style="text-align:left">禁用反向显示</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[28m</code></td><td style="text-align:left">禁用隐藏显示</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[29m</code></td><td style="text-align:left">闲置</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="前景色配置">前景色配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%89%8D%E6%99%AF%E8%89%B2%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="前景色配置的直接链接" title="前景色配置的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>setaf 0</code></td><td style="text-align:center"><code>\e[30m</code></td><td style="text-align:left">将前景色设置为黑色</td></tr><tr><td style="text-align:left"><code>setaf 1</code></td><td style="text-align:center"><code>\e[31m</code></td><td style="text-align:left">将前景色设置为红色</td></tr><tr><td style="text-align:left"><code>setaf 2</code></td><td style="text-align:center"><code>\e[32m</code></td><td style="text-align:left">将前景色设置为绿色</td></tr><tr><td style="text-align:left"><code>setaf 3</code></td><td style="text-align:center"><code>\e[33m</code></td><td style="text-align:left">将前景色设置为黄色</td></tr><tr><td style="text-align:left"><code>setaf 4</code></td><td style="text-align:center"><code>\e[34m</code></td><td style="text-align:left">将前景色设置为蓝色</td></tr><tr><td style="text-align:left"><code>setaf 5</code></td><td style="text-align:center"><code>\e[35m</code></td><td style="text-align:left">将前景色设置为杨红色</td></tr><tr><td style="text-align:left"><code>setaf 6</code></td><td style="text-align:center"><code>\e[36m</code></td><td style="text-align:left">将前景色设置为青色</td></tr><tr><td style="text-align:left"><code>setaf 7</code></td><td style="text-align:center"><code>\e[37m</code></td><td style="text-align:left">将前景色设置为白色</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[38m</code></td><td style="text-align:left">闲置</td></tr><tr><td style="text-align:left"><code>setaf 9</code></td><td style="text-align:center"><code>\e[39m</code></td><td style="text-align:left">将前景色设置为默认色</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="背景色设置">背景色设置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E8%83%8C%E6%99%AF%E8%89%B2%E8%AE%BE%E7%BD%AE" class="hash-link" aria-label="背景色设置的直接链接" title="背景色设置的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>setab 0</code></td><td style="text-align:center"><code>\e[40m</code></td><td style="text-align:left">将背景色设置为黑色</td></tr><tr><td style="text-align:left"><code>setab 1</code></td><td style="text-align:center"><code>\e[41m</code></td><td style="text-align:left">将背景色设置为红色</td></tr><tr><td style="text-align:left"><code>setab 2</code></td><td style="text-align:center"><code>\e[42m</code></td><td style="text-align:left">将背景色设置为绿色</td></tr><tr><td style="text-align:left"><code>setab 3</code></td><td style="text-align:center"><code>\e[43m</code></td><td style="text-align:left">将背景色设置为黄色</td></tr><tr><td style="text-align:left"><code>setab 4</code></td><td style="text-align:center"><code>\e[44m</code></td><td style="text-align:left">将背景色设置为蓝色</td></tr><tr><td style="text-align:left"><code>setab 5</code></td><td style="text-align:center"><code>\e[45m</code></td><td style="text-align:left">将背景色设置为杨红色</td></tr><tr><td style="text-align:left"><code>setab 6</code></td><td style="text-align:center"><code>\e[46m</code></td><td style="text-align:left">将背景色设置为青色</td></tr><tr><td style="text-align:left"><code>setab 7</code></td><td style="text-align:center"><code>\e[47m</code></td><td style="text-align:left">将背景色设置为白色</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[48m</code></td><td style="text-align:left">闲置</td></tr><tr><td style="text-align:left"><code>setab 9</code></td><td style="text-align:center"><code>\e[49m</code></td><td style="text-align:left">将背景色设置为默认色</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="其他转义序列">其他转义序列<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%85%B6%E4%BB%96%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97" class="hash-link" aria-label="其他转义序列的直接链接" title="其他转义序列的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="重置终端">重置终端<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E9%87%8D%E7%BD%AE%E7%BB%88%E7%AB%AF" class="hash-link" aria-label="重置终端的直接链接" title="重置终端的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>reset</code></td><td style="text-align:center"><code>\ec</code></td><td style="text-align:left">将前景色和背景色设置为默认值，清除屏幕，并将光标移动到默认位置</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="整屏滚动">整屏滚动<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E6%95%B4%E5%B1%8F%E6%BB%9A%E5%8A%A8" class="hash-link" aria-label="整屏滚动的直接链接" title="整屏滚动的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="清除屏幕">清除屏幕<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E6%B8%85%E9%99%A4%E5%B1%8F%E5%B9%95" class="hash-link" aria-label="清除屏幕的直接链接" title="清除屏幕的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>cd</code></td><td style="text-align:center"><code>\e[J</code> 或 <code>\e[0J</code></td><td style="text-align:left">使用当前背景色清除到屏幕底部</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[1J</code></td><td style="text-align:left">使用当前背景色清理到顶部</td></tr><tr><td style="text-align:left"><code>cl</code></td><td style="text-align:center"><code>\e[2J</code></td><td style="text-align:left">将屏幕清除为当前背景色。在部分终端上，还会将光标的位置重置到 home 位置</td></tr><tr><td style="text-align:left"><code>c</code></td><td style="text-align:center"><code>\e[3J</code></td><td style="text-align:left">将清除整个屏幕并删除回滚缓冲区中的所有行（该特性是 <a href="https://xterm.dev/" target="_blank" rel="noopener noreferrer" class="">xterm</a>,其他终端也支持 ）</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="清除行">清除行<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E6%B8%85%E9%99%A4%E8%A1%8C" class="hash-link" aria-label="清除行的直接链接" title="清除行的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>ce</code></td><td style="text-align:center"><code>\e[K</code> 或 <code>\e[0K</code></td><td style="text-align:left">清除当前行到末尾</td></tr><tr><td style="text-align:left"><code>cb</code></td><td style="text-align:center"><code>\e[1K</code></td><td style="text-align:left">清除行到开头</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[2K</code></td><td style="text-align:left">清除当前行</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="制表符">制表符<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%88%B6%E8%A1%A8%E7%AC%A6" class="hash-link" aria-label="制表符的直接链接" title="制表符的直接链接" translate="no">​</a></h3>
<table><thead><tr><th style="text-align:left">shell 脚本使用 <code>tput xx</code></th><th style="text-align:center">转义序列</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left"><code>hts</code></td><td style="text-align:center"><code>\e[W</code> 或 <code>\e[0W</code></td><td style="text-align:left">在光标位置设置水平制表符</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[1W</code></td><td style="text-align:left">当前行设置垂直制表符</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[ 2 - 6 W</code></td><td style="text-align:left">冗余代码</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[g</code> 或 <code>\e[0g</code></td><td style="text-align:left">清除当前光标位置的水平制表符</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[1g</code></td><td style="text-align:left">清除当前行的垂直制表符</td></tr><tr><td style="text-align:left">--</td><td style="text-align:center"><code>\e[2g</code></td><td style="text-align:left">仅清除当前行的水平和垂直制表位</td></tr><tr><td style="text-align:left"><code>tbc</code></td><td style="text-align:center"><code>\e[3g</code></td><td style="text-align:left">清除所有的说平选项卡</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="参考文档">参考文档<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/ANSI%20%E8%BD%AC%E4%B9%89%E7%A0%81#%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3" class="hash-link" aria-label="参考文档的直接链接" title="参考文档的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://zh.wikipedia.org/wiki/ANSI%E8%BD%AC%E4%B9%89%E5%BA%8F%E5%88%97" target="_blank" rel="noopener noreferrer" class="">wiki 中文 - ANSI 转义序列</a></li>
<li class=""><a href="https://developer.apple.com/library/archive/documentation/OpenSource/Conceptual/ShellScripting/AdvancedTechniques/AdvancedTechniques.html#//apple_ref/doc/uid/TP40004268-TP40003521-SW27" target="_blank" rel="noopener noreferrer" class="">apple shell 脚本入门 - 高级技术 - ANSI 转义篇</a></li>
<li class=""><a href="https://www.inwap.com/pdp10/ansicode.txt" target="_blank" rel="noopener noreferrer" class="">ANSI 84 年 标准摘要</a></li>
<li class=""><a href="https://earthnutdev.github.io/assets/files/ansi-84-52e3d322341ef6d2bfb8d4c8ce607b8a.txt" target="_blank" class="">ANSI 84 年 标准摘要（译文版）</a></li>
</ul>]]></content:encoded>
            <category>shell</category>
        </item>
        <item>
            <title><![CDATA[node 失灵了]]></title>
            <link>https://earthnutDev.github.io/日志/node 失灵了</link>
            <guid>https://earthnutDev.github.io/日志/node 失灵了</guid>
            <pubDate>Sat, 29 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[node 不知何故用不了了]]></description>
            <content:encoded><![CDATA[<p>在 macOS 特别是 Apple Silicon (M1/M2) 设备上，Homebrew 的路径结构和符号链接机制与 Intel 芯片 Mac 不同。以下是您遇到的现象的原理详解和解决方案：</p>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="一路径结构解析apple-silicon-芯片">一、路径结构解析（Apple Silicon 芯片）<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#%E4%B8%80%E8%B7%AF%E5%BE%84%E7%BB%93%E6%9E%84%E8%A7%A3%E6%9E%90apple-silicon-%E8%8A%AF%E7%89%87" class="hash-link" aria-label="一、路径结构解析（Apple Silicon 芯片）的直接链接" title="一、路径结构解析（Apple Silicon 芯片）的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="1-homebrew-默认安装路径">1. Homebrew 默认安装路径<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#1-homebrew-%E9%BB%98%E8%AE%A4%E5%AE%89%E8%A3%85%E8%B7%AF%E5%BE%84" class="hash-link" aria-label="1. Homebrew 默认安装路径的直接链接" title="1. Homebrew 默认安装路径的直接链接" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">/opt/homebrew/          </span><span class="token comment" style="color:#999988;font-style:italic"># ARM 版 Homebrew 主目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── bin/                </span><span class="token comment" style="color:#999988;font-style:italic"># 全局可执行文件符号链接</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── opt/                </span><span class="token comment" style="color:#999988;font-style:italic"># 实际安装的软件包</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── node/           </span><span class="token comment" style="color:#999988;font-style:italic"># Node.js 的主程序文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── lib/                </span><span class="token comment" style="color:#999988;font-style:italic"># 共享库和依赖</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── node_modules/   </span><span class="token comment" style="color:#999988;font-style:italic"># 全局 npm 包安装目录</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="2-关键路径说明">2. 关键路径说明<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#2-%E5%85%B3%E9%94%AE%E8%B7%AF%E5%BE%84%E8%AF%B4%E6%98%8E" class="hash-link" aria-label="2. 关键路径说明的直接链接" title="2. 关键路径说明的直接链接" translate="no">​</a></h4>
<table><thead><tr><th>路径</th><th>作用</th></tr></thead><tbody><tr><td><code>/opt/homebrew/opt/node</code></td><td>Node.js 的实际安装目录</td></tr><tr><td><code>/opt/homebrew/bin/node</code></td><td>指向实际可执行文件的符号链接</td></tr><tr><td><code>/opt/homebrew/lib/node_modules</code></td><td>全局 npm 包的安装位置</td></tr></tbody></table>
<hr>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="二现象原理分析">二、现象原理分析<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#%E4%BA%8C%E7%8E%B0%E8%B1%A1%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90" class="hash-link" aria-label="二、现象原理分析的直接链接" title="二、现象原理分析的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="1-符号链接机制">1. 符号链接机制<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#1-%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5%E6%9C%BA%E5%88%B6" class="hash-link" aria-label="1. 符号链接机制的直接链接" title="1. 符号链接机制的直接链接" translate="no">​</a></h4>
<p>执行 <code>ls -l $(brew --prefix node)/bin</code> 显示的是 <strong>软件包内部</strong> 的 bin 目录结构：</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># brew --prefix node 返回的是软件包安装路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/homebrew/opt/node/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看内容会显示原始链接关系</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/node_modules/npm/bin/node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/node_modules/npm/bin/npm-cli.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/node_modules/npm/bin/npx-cli.js</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="2-实际生效路径">2. 实际生效路径<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#2-%E5%AE%9E%E9%99%85%E7%94%9F%E6%95%88%E8%B7%AF%E5%BE%84" class="hash-link" aria-label="2. 实际生效路径的直接链接" title="2. 实际生效路径的直接链接" translate="no">​</a></h4>
<p>Homebrew 会将这些可执行文件 <strong>再次链接到全局 bin 目录</strong>：</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 实际生效的全局路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/opt/homebrew/bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/opt/node/bin/node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/node_modules/npm/bin/npm-cli.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── npx -</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">/lib/node_modules/npm/bin/npx-cli.js</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="三验证与解决方案">三、验证与解决方案<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#%E4%B8%89%E9%AA%8C%E8%AF%81%E4%B8%8E%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" class="hash-link" aria-label="三、验证与解决方案的直接链接" title="三、验证与解决方案的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="1-确认全局命令路径">1. 确认全局命令路径<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#1-%E7%A1%AE%E8%AE%A4%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4%E8%B7%AF%E5%BE%84" class="hash-link" aria-label="1. 确认全局命令路径的直接链接" title="1. 确认全局命令路径的直接链接" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看 node 的真实调用路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 正确应输出：/opt/homebrew/bin/node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 查看符号链接最终指向</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-l</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">which</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">node</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 输出示例：/opt/homebrew/bin/node -&gt; ../opt/node/bin/node</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="2-修复环境变量配置">2. 修复环境变量配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#2-%E4%BF%AE%E5%A4%8D%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="2. 修复环境变量配置的直接链接" title="2. 修复环境变量配置的直接链接" translate="no">​</a></h4>
<p>检查 <code>PATH</code> 变量是否包含 Homebrew 的 bin 目录：</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 正确顺序应优先包含 /opt/homebrew/bin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 示例：/opt/homebrew/bin:/usr/bin:/bin...</span><br></span></code></pre></div></div>
<p>修改 shell 配置文件（以 zsh 为例）：</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 编辑配置文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">nano</span><span class="token plain"> ~/.zshrc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 确保有以下内容（如果使用 bash 则修改 ~/.bash_profile）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">export</span><span class="token plain"> </span><span class="token assign-left variable environment constant" style="color:#36acaa">PATH</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"/opt/homebrew/bin:</span><span class="token string environment constant" style="color:#36acaa">$PATH</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 使配置生效</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">source</span><span class="token plain"> ~/.zshrc</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="3-强制重建符号链接">3. 强制重建符号链接<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#3-%E5%BC%BA%E5%88%B6%E9%87%8D%E5%BB%BA%E7%AC%A6%E5%8F%B7%E9%93%BE%E6%8E%A5" class="hash-link" aria-label="3. 强制重建符号链接的直接链接" title="3. 强制重建符号链接的直接链接" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 解除现有链接并重新创建</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew unlink </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> brew </span><span class="token function" style="color:#d73a49">link</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--overwrite</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 示例成功输出：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Linking /opt/homebrew/Cellar/node/xx.x.x... 7 symlinks created.</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="四高级故障排查">四、高级故障排查<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#%E5%9B%9B%E9%AB%98%E7%BA%A7%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5" class="hash-link" aria-label="四、高级故障排查的直接链接" title="四、高级故障排查的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="场景-1存在多个-node-版本冲突">场景 1：存在多个 node 版本冲突<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#%E5%9C%BA%E6%99%AF-1%E5%AD%98%E5%9C%A8%E5%A4%9A%E4%B8%AA-node-%E7%89%88%E6%9C%AC%E5%86%B2%E7%AA%81" class="hash-link" aria-label="场景 1：存在多个 node 版本冲突的直接链接" title="场景 1：存在多个 node 版本冲突的直接链接" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 查看所有 node 安装位置</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mdfind </span><span class="token parameter variable" style="color:#36acaa">-name</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">grep</span><span class="token plain"> bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 典型冲突路径：</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /opt/homebrew/bin/node     （Homebrew 安装）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># /usr/local/bin/node        （其他方式安装）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># ~/.nvm/versions/node/...   （nvm 安装）</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 解决方案：删除其他安装或调整 PATH 优先级</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="场景-2权限问题修复">场景 2：权限问题修复<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#%E5%9C%BA%E6%99%AF-2%E6%9D%83%E9%99%90%E9%97%AE%E9%A2%98%E4%BF%AE%E5%A4%8D" class="hash-link" aria-label="场景 2：权限问题修复的直接链接" title="场景 2：权限问题修复的直接链接" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 重置 Homebrew 目录权限</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-R</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">whoami</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain"> /opt/homebrew/*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-R</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">755</span><span class="token plain"> /opt/homebrew/*</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="场景-3完整重装">场景 3：完整重装<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#%E5%9C%BA%E6%99%AF-3%E5%AE%8C%E6%95%B4%E9%87%8D%E8%A3%85" class="hash-link" aria-label="场景 3：完整重装的直接链接" title="场景 3：完整重装的直接链接" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 完全卸载</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew uninstall </span><span class="token parameter variable" style="color:#36acaa">--force</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-rf</span><span class="token plain"> /opt/homebrew/lib/node_modules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 清理缓存</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew cleanup </span><span class="token parameter variable" style="color:#36acaa">--prune</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">all</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 重新安装</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><br></span></code></pre></div></div>
<hr>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="五路径结构示意图">五、路径结构示意图<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/node%20%E5%A4%B1%E7%81%B5%E4%BA%86#%E4%BA%94%E8%B7%AF%E5%BE%84%E7%BB%93%E6%9E%84%E7%A4%BA%E6%84%8F%E5%9B%BE" class="hash-link" aria-label="五、路径结构示意图的直接链接" title="五、路径结构示意图的直接链接" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-text codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">Homebrew ARM 架构目录树</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── node -&gt; ../opt/node/bin/node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── npm -&gt; ../lib/node_modules/npm/bin/npm-cli.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── npx -&gt; ../lib/node_modules/npm/bin/npx-cli.js</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── opt/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── node/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       ├── bin/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│       └── lib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── lib/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    └── node_modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        └── npm/         # 全局 npm 包</span><br></span></code></pre></div></div>
<p>通过理解 Homebrew 在 Apple Silicon 设备上的路径设计，您可以更从容地管理 Node.js 环境。若问题依旧存在，建议提供以下信息以便进一步诊断：</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">brew config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">brew doctor</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token environment constant" style="color:#36acaa">$PATH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">which</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-a</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">node</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>npm 包</category>
        </item>
        <item>
            <title><![CDATA[Emoji 的使用]]></title>
            <link>https://earthnutDev.github.io/日志/Emoji 的使用</link>
            <guid>https://earthnutDev.github.io/日志/Emoji 的使用</guid>
            <pubDate>Fri, 28 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[在 `CHANGELOG.md` 文件中，使用 Emoji 添加色彩]]></description>
            <content:encoded><![CDATA[<p>在 <code>CHANGELOG.md</code> 文件中，使用 Emoji 可以直观标识不同类型的变更。以下是常见的 Emoji 及其含义：</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="常用-emoji-分类"><strong>常用 Emoji 分类</strong><a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/Emoji%20%E7%9A%84%E4%BD%BF%E7%94%A8#%E5%B8%B8%E7%94%A8-emoji-%E5%88%86%E7%B1%BB" class="hash-link" aria-label="常用-emoji-分类的直接链接" title="常用-emoji-分类的直接链接" translate="no">​</a></h2>
<!-- -->
<table><thead><tr><th>Emoji</th><th>含义</th><th>示例场景</th></tr></thead><tbody><tr><td>✨</td><td>新功能</td><td>新增模块、API 或重大特性</td></tr><tr><td>🐛</td><td>Bug 修复</td><td>修复代码缺陷、崩溃问题</td></tr><tr><td>🚀</td><td>性能优化</td><td>提升速度、减少资源占用</td></tr><tr><td>🎨</td><td>代码/UI 改进</td><td>重构代码、优化交互设计</td></tr><tr><td>📚</td><td>文档更新</td><td>完善文档、教程或注释</td></tr><tr><td>⚠️</td><td>弃用警告</td><td>标记即将弃用的功能</td></tr><tr><td>🔧</td><td>配置变更</td><td>修改配置文件或环境变量</td></tr><tr><td>🔒</td><td>安全修复</td><td>修补安全漏洞</td></tr><tr><td>🌐</td><td>国际化</td><td>支持新语言或本地化优化</td></tr><tr><td>🚨</td><td>重要变更</td><td>破坏性的 API 变更</td></tr><tr><td>🎉</td><td>初始版本</td><td>项目首次发布</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="使用示例"><strong>使用示例</strong><a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/Emoji%20%E7%9A%84%E4%BD%BF%E7%94%A8#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="使用示例的直接链接" title="使用示例的直接链接" translate="no">​</a></h2>
<div class="language-markdown codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-markdown codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token title important punctuation" style="color:#393A34">##</span><span class="token title important"> [1.2.0] - 2023-04-06</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 新增功能 ✨</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 新增用户登录验证码功能</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> Bug 修复 🐛</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 修复首页加载缓慢的 bug</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 性能优化 🚀</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 优化数据库查询效率</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token title important punctuation" style="color:#393A34">###</span><span class="token title important"> 文档更新 📚</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token list punctuation" style="color:#393A34">-</span><span class="token plain"> 完善 API 文档示例</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="最佳实践"><strong>最佳实践</strong><a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/Emoji%20%E7%9A%84%E4%BD%BF%E7%94%A8#%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5" class="hash-link" aria-label="最佳实践的直接链接" title="最佳实践的直接链接" translate="no">​</a></h2>
<ol>
<li class=""><strong>一致性</strong>：<br>
<!-- -->在团队中统一 Emoji 使用规范，避免混淆。</li>
<li class=""><strong>简洁性</strong>：<br>
<!-- -->每个变更类型使用 1 个 Emoji，避免过度使用。</li>
<li class=""><strong>语义化</strong>：<br>
<!-- -->确保 Emoji 准确反映变更类型。</li>
</ol>
<p>通过合理使用 Emoji，可以让 <code>CHANGELOG.md</code> 更清晰易读。</p>]]></content:encoded>
            <category>npm 包</category>
        </item>
        <item>
            <title><![CDATA[手动触发 github actions]]></title>
            <link>https://earthnutDev.github.io/日志/手动触发 github actions</link>
            <guid>https://earthnutDev.github.io/日志/手动触发 github actions</guid>
            <pubDate>Wed, 26 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[手动触发 github actions]]></description>
            <content:encoded><![CDATA[<p>有时候由于非代码原因，需要手动触发 github actions，比如：测试、部署等。</p>
<p>手动触发 github actions 可以通过以下两种方式：</p>
<ul>
<li class="">通过 <a href="https://github.com/fe6/wxapp-uniapp/actions" target="_blank" rel="noopener noreferrer" class="">Actions</a> 页面手动触发</li>
<li class="">通过 <a href="https://github.com/fe6/wxapp-uniapp/actions" target="_blank" rel="noopener noreferrer" class="">Actions</a> 页面的 <code>Run workflow</code> 按钮触发</li>
</ul>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="通过-actions-页面手动触发">通过 Actions 页面手动触发<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%20github%20actions#%E9%80%9A%E8%BF%87-actions-%E9%A1%B5%E9%9D%A2%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91" class="hash-link" aria-label="通过 Actions 页面手动触发的直接链接" title="通过 Actions 页面手动触发的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="添加配置">添加配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%20github%20actions#%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="添加配置的直接链接" title="添加配置的直接链接" translate="no">​</a></h3>
<p>在 Workflow 文件夹下，添加 <code>workflow_dispatch</code> 文件，内容如下：</p>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions 动作</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflow_dispatch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'触发原因'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">required</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'手动触发'</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="通过-actions-页面的-run-workflow-按钮触发">通过 Actions 页面的 <code>Run workflow</code> 按钮触发<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%20github%20actions#%E9%80%9A%E8%BF%87-actions-%E9%A1%B5%E9%9D%A2%E7%9A%84-run-workflow-%E6%8C%89%E9%92%AE%E8%A7%A6%E5%8F%91" class="hash-link" aria-label="通过-actions-页面的-run-workflow-按钮触发的直接链接" title="通过-actions-页面的-run-workflow-按钮触发的直接链接" translate="no">​</a></h3>
<p>在 Actions 页面，点击 <code>Run workflow</code> 按钮，选择需要触发的 workflow，点击 <code>Run workflow</code> 按钮即可。</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">https://github.com/userName/propName/actions/workflows/</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="通过-github-api-触发">通过 GIthub API 触发<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%20github%20actions#%E9%80%9A%E8%BF%87-github-api-%E8%A7%A6%E5%8F%91" class="hash-link" aria-label="通过 GIthub API 触发的直接链接" title="通过 GIthub API 触发的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="生成-token">生成 token<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%20github%20actions#%E7%94%9F%E6%88%90-token" class="hash-link" aria-label="生成 token的直接链接" title="生成 token的直接链接" translate="no">​</a></h3>
<p>在 <a href="https://github.com/settings/tokens" target="_blank" rel="noopener noreferrer" class="">Personal access tokens</a> 页面，点击 <code>Generate new token</code> 按钮，输入 token 描述，勾选 <code>repo</code> 和 <code>workflow</code> 权限，点击 <code>Generate token</code> 按钮，复制生成的 token。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="生成-curl-命令">生成 curl 命令<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%89%8B%E5%8A%A8%E8%A7%A6%E5%8F%91%20github%20actions#%E7%94%9F%E6%88%90-curl-%E5%91%BD%E4%BB%A4" class="hash-link" aria-label="生成 curl 命令的直接链接" title="生成 curl 命令的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-X</span><span class="token plain"> POST </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-H</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Authorization: token &lt;KEY&gt;"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-H</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"Accept: application/vnd.github.v3+json"</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  https://api.github.com/repos/fe6/wxapp-uniapp/actions/workflows/123456789/dispatches </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token parameter variable" style="color:#36acaa">-d</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'{"ref":"main", "inputs": {"name": "手动触发"}'</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>自动化</category>
        </item>
        <item>
            <title><![CDATA[github ip 直连]]></title>
            <link>https://earthnutDev.github.io/日志/github ip 直连</link>
            <guid>https://earthnutDev.github.io/日志/github ip 直连</guid>
            <pubDate>Tue, 25 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[在 ping github.com 不同时可选方案之 github ip 直连]]></description>
            <content:encoded><![CDATA[<p>在提交代码时遇见了点问题，以为只是暂时的网络问题，没太注意。知道后来提交尝试很多次，发现 ping github.com 也不通。于是，开始查找原因。</p>
<p>ping 可以通过发送 ICMP 协议包检测当前设备于目标服务器之间的🛜连通性。但在 DNS 被污染时，是没有办法甄别。</p>
<p>所以需要使用添加 IP 直连的方式，来绕过 DNS 解析。</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="查看-github-ip">查看 github ip<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20ip%20%E7%9B%B4%E8%BF%9E#%E6%9F%A5%E7%9C%8B-github-ip" class="hash-link" aria-label="查看 github ip的直接链接" title="查看 github ip的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="官网查找">官网查找<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20ip%20%E7%9B%B4%E8%BF%9E#%E5%AE%98%E7%BD%91%E6%9F%A5%E6%89%BE" class="hash-link" aria-label="官网查找的直接链接" title="官网查找的直接链接" translate="no">​</a></h3>
<p>在 <a href="https://docs.github.com/en/github/authenticating-to-github/about-githubs-ip-addresses" target="_blank" rel="noopener noreferrer" class="">github ip</a> 中可以查看到 github 的 ip 地址。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="使用-google-dns-查询">使用 Google DNS 查询<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20ip%20%E7%9B%B4%E8%BF%9E#%E4%BD%BF%E7%94%A8-google-dns-%E6%9F%A5%E8%AF%A2" class="hash-link" aria-label="使用 Google DNS 查询的直接链接" title="使用 Google DNS 查询的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">nslookup</span><span class="token plain"> github.com </span><span class="token number" style="color:#36acaa">8.8</span><span class="token plain">.8.8</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="使用-dig-查询">使用 dig 查询<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20ip%20%E7%9B%B4%E8%BF%9E#%E4%BD%BF%E7%94%A8-dig-%E6%9F%A5%E8%AF%A2" class="hash-link" aria-label="使用 dig 查询的直接链接" title="使用 dig 查询的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">dig</span><span class="token plain"> @1.1.1.1 github.com +short</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="通过在线工具">通过在线工具<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20ip%20%E7%9B%B4%E8%BF%9E#%E9%80%9A%E8%BF%87%E5%9C%A8%E7%BA%BF%E5%B7%A5%E5%85%B7" class="hash-link" aria-label="通过在线工具的直接链接" title="通过在线工具的直接链接" translate="no">​</a></h3>
<ul>
<li class="">
<p><a href="https://dnschecker.org/#A/github.com" target="_blank" rel="noopener noreferrer" class="">dnschecker</a></p>
</li>
<li class="">
<p><a href="https://www.whatsmydns.net/#A/github.com" target="_blank" rel="noopener noreferrer" class="">whatsmydns ip</a></p>
</li>
<li class="">
<p><a href="https://www.ipaddress.com/github.com" target="_blank" rel="noopener noreferrer" class="">github ip</a></p>
<p><em>工具排名不分先后</em></p>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="添加-ip-直连">添加 ip 直连<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20ip%20%E7%9B%B4%E8%BF%9E#%E6%B7%BB%E5%8A%A0-ip-%E7%9B%B4%E8%BF%9E" class="hash-link" aria-label="添加 ip 直连的直接链接" title="添加 ip 直连的直接链接" translate="no">​</a></h2>
<p>在 <code>hosts</code> 文件中添加 github ip 地址，即可绕过 DNS 解析。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="windows">windows<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20ip%20%E7%9B%B4%E8%BF%9E#windows" class="hash-link" aria-label="windows的直接链接" title="windows的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">C:/Windows/System32/drivers/etc/hosts</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="maclinux">mac/linux<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20ip%20%E7%9B%B4%E8%BF%9E#maclinux" class="hash-link" aria-label="mac/linux的直接链接" title="mac/linux的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">vim</span><span class="token plain"> /etc/hosts</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>git</category>
        </item>
        <item>
            <title><![CDATA[git 小改动的时提交技巧]]></title>
            <link>https://earthnutDev.github.io/日志/git 小改动的时提交技巧</link>
            <guid>https://earthnutDev.github.io/日志/git 小改动的时提交技巧</guid>
            <pubDate>Mon, 24 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用 git 提交小改动时的技巧]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorTargetStickyNavbar_e79m" id="合并提交">合并提交<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/git%20%E5%B0%8F%E6%94%B9%E5%8A%A8%E7%9A%84%E6%97%B6%E6%8F%90%E4%BA%A4%E6%8A%80%E5%B7%A7#%E5%90%88%E5%B9%B6%E6%8F%90%E4%BA%A4" class="hash-link" aria-label="合并提交的直接链接" title="合并提交的直接链接" translate="no">​</a></h2>
<p>若是频繁的为小改动，可以在推送前合并为一次提交</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> rebase </span><span class="token parameter variable" style="color:#36acaa">-i</span><span class="token plain"> HEAD~3</span><br></span></code></pre></div></div>
<p>上面的代码将合并最近三次的提交。</p>
<ol>
<li class="">找到需要合并的提交，修改为<code>squash</code>，其他保持不变。</li>
<li class="">保存并退出。</li>
<li class="">推送到远程仓库。</li>
</ol>
<p>这样，你的改动将会被合并为一次提交，并保留你的贡献者信息。</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="追加为一次提交">追加为一次提交<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/git%20%E5%B0%8F%E6%94%B9%E5%8A%A8%E7%9A%84%E6%97%B6%E6%8F%90%E4%BA%A4%E6%8A%80%E5%B7%A7#%E8%BF%BD%E5%8A%A0%E4%B8%BA%E4%B8%80%E6%AC%A1%E6%8F%90%E4%BA%A4" class="hash-link" aria-label="追加为一次提交的直接链接" title="追加为一次提交的直接链接" translate="no">​</a></h2>
<p>在 git 中，你可以使用 <code>git commit --amend</code> 命令来修改最近一次的提交。</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> </span><span class="token builtin class-name">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> commit </span><span class="token parameter variable" style="color:#36acaa">--amend</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">-m</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"你的修改说明"</span><span class="token plain"> --no-edit</span><br></span></code></pre></div></div>
<ol>
<li class="">首先，使用 <code>git add</code> 命令来添加需要修改的文件。</li>
<li class="">使用 <code>git commit --amend -m "你的修改说明" --no-edit</code> 命令来修改最近一次的提交。</li>
<li class="">保存并退出。</li>
</ol>
<p>这样，你的改动将会被追加到最近一次的提交中，并保留你的贡献者信息。</p>]]></content:encoded>
            <category>git</category>
        </item>
        <item>
            <title><![CDATA[type: module ? commonjs ?]]></title>
            <link>https://earthnutDev.github.io/日志/type: module ？ commonjs ？</link>
            <guid>https://earthnutDev.github.io/日志/type: module ？ commonjs ？</guid>
            <pubDate>Sun, 23 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用 docusaurus 时配置 package.json 的 type 值]]></description>
            <content:encoded><![CDATA[<p>在项目添加单独 <code>eslint</code> 配置时，执行 <code>npx eslint .</code> 后空台台显示一个提示 <code>package.json</code> 缺失 <code>type</code> 属性。但显示并不是错误，而是提示 <code>package.json</code> 的 <code>type</code> 属性缺失，可以忽略，但建议配置 <code>"type": "module"</code>。</p>
<p>手快的我直接在 <code>package.json</code> 文件中添加了该属性。</p>
<p>a few days later...</p>
<!-- -->
<p>构建打包时，报错：</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ERROR</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Error: Unable to build website </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> locale zh-Hans.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">cause</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">: TypeError: require.resolveWeak is not a </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain">.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">INFO</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> Docusaurus version: </span><span class="token number" style="color:#36acaa">3.7</span><span class="token plain">.0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Node version: v23.3.0</span><br></span></code></pre></div></div>
<p>由于错误中包含 <code>node</code> 和 <code>docusaurus</code> 的版本信息，我尝试了更改 <code>node</code> 和 <code>docusaurus</code> 的版本，但问题仍然存在。</p>
<p>于是怀疑是不是最近添加的 <code>eslint</code>、'prettier'、<code>husky</code>、<code>lint-staged</code> 等包导致，于是我尝试了删除这些包，但问题仍然存在。</p>
<p>怀疑是执行了 <code>npm update --save</code> 更新依赖导致的错误，然后一个包一个包的版本回退，问题依旧。</p>
<p>最后只能 git 回退到之前的版本，问题解决。仔细查看两个 git 版本的差异，发现 <code>package-lock.json</code> 文件中的 <code>type</code> 字段被改为 <code>module</code>，这是由 <code>package.json</code> 文件中的 <code>type</code> 字段改为 <code>module</code> 所导致的。</p>]]></content:encoded>
            <category>建站</category>
        </item>
        <item>
            <title><![CDATA[提交代码前自动格式化代码]]></title>
            <link>https://earthnutDev.github.io/日志/提交代码前自动格式化代码</link>
            <guid>https://earthnutDev.github.io/日志/提交代码前自动格式化代码</guid>
            <pubDate>Sat, 22 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用 husky + lint-staged + prettier + eslint 提交代码前自动格式化代码]]></description>
            <content:encoded><![CDATA[<p>为了保证代码风格统一，使用 husky + lint-staged + prettier + eslint 提交代码前自动格式化代码。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="背景">背景<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%89%8D%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81#%E8%83%8C%E6%99%AF" class="hash-link" aria-label="背景的直接链接" title="背景的直接链接" translate="no">​</a></h2>
<p>当使用 <code>husky</code> 后，在 <code>git commit</code> 时：</p>
<ul>
<li class="">自动执行 <code>pre-commit</code> 钩子</li>
<li class="">然后执行 <code>lint-staged</code></li>
<li class="">再执行 <code>prettier</code></li>
<li class="">最后执行 <code>eslint</code></li>
</ul>
<p>操作会自动用 Prettier 和 ESLint 格式化暂存区（git add 过的文件）的代码，并检查代码是否符合规范。格式化的改动会自动添加到本次提交，无需手动操作。</p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="安装依赖">安装依赖<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%89%8D%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96" class="hash-link" aria-label="安装依赖的直接链接" title="安装依赖的直接链接" translate="no">​</a></h2>
<p>项目下执行：</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev husky lint-staged prettier eslint</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="初始化-husky">初始化 Husky<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%89%8D%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81#%E5%88%9D%E5%A7%8B%E5%8C%96-husky" class="hash-link" aria-label="初始化 Husky的直接链接" title="初始化 Husky的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> pkg </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">scripts.prettier</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"npx ixxx cls &amp;&amp; prettier . --write"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> pkg </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">scripts.beautify</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"npm run prettier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> pkg </span><span class="token builtin class-name">set</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">scripts.eslint</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"npx ixxx cls &amp;&amp; eslint src"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx husky init</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="创建-git-钩子">创建 git 钩子<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%89%8D%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81#%E5%88%9B%E5%BB%BA-git-%E9%92%A9%E5%AD%90" class="hash-link" aria-label="创建 git 钩子的直接链接" title="创建 git 钩子的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="version--7">version &lt; 7<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%89%8D%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81#version--7" class="hash-link" aria-label="version < 7的直接链接" title="version < 7的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">npx husky </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> .husky/pre-commit </span><span class="token string" style="color:#e3116c">"npx lint-staged"</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="version--7-1">version &gt;= 7<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%89%8D%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81#version--7-1" class="hash-link" aria-label="version >= 7的直接链接" title="version >= 7的直接链接" translate="no">​</a></h3>
<p>从 Husky v7 版本开始，husky add 命令就已被弃用。现在创建钩子需要直接编辑 .husky 目录下的脚本文件。</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">## 一个 &gt; 是写文件 两个 &gt; 是追加文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"npx lint-staged</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> .husky/pre-commit </span><span class="token comment" style="color:#999988;font-style:italic"># 覆盖文件内容</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">printf</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"npx lint-staged</span><span class="token string entity" style="color:#36acaa">\n</span><span class="token string" style="color:#e3116c">"</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> .husky/pre-commit </span><span class="token comment" style="color:#999988;font-style:italic"># 追加到文件末尾</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="配置-lint-staged">配置 lint-staged<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81%E5%89%8D%E8%87%AA%E5%8A%A8%E6%A0%BC%E5%BC%8F%E5%8C%96%E4%BB%A3%E7%A0%81#%E9%85%8D%E7%BD%AE-lint-staged" class="hash-link" aria-label="配置 lint-staged的直接链接" title="配置 lint-staged的直接链接" translate="no">​</a></h2>
<p>在 <code>package.json</code> 中添加：</p>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"lint-staged"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"*.{js,jsx,ts,tsx,md,mdx,json}"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"eslint --fix"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"prettier --write"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>自动化</category>
        </item>
        <item>
            <title><![CDATA[GPG 签名]]></title>
            <link>https://earthnutDev.github.io/日志/GPG 签名</link>
            <guid>https://earthnutDev.github.io/日志/GPG 签名</guid>
            <pubDate>Wed, 19 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用 GPG 签名让 GitHub 仓库的提交和标签更安全]]></description>
            <content:encoded><![CDATA[<p>在使用命令 <code>git tag v0.1.0 -v</code> 时发现在展示的信息末尾包含了一句 “error: no signature found”。一检索，才发现是自己在查看 commit 标签时使用错了命令。正确应当是 <code>git show v0.1.0</code>。于是捎带脚的查了下 <a href="https://gnupg.org/" target="_blank" rel="noopener noreferrer" class="">GPG</a></p>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="安装-gpg">安装 <a href="https://gnupg.org/" target="_blank" rel="noopener noreferrer" class="">GPG</a><a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E5%AE%89%E8%A3%85-gpg" class="hash-link" aria-label="安装-gpg的直接链接" title="安装-gpg的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="linux">Linux<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#linux" class="hash-link" aria-label="Linux的直接链接" title="Linux的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">apt-get</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gnupg </span><span class="token comment" style="color:#999988;font-style:italic"># Ubuntu/Debian</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> yum </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gnupg </span><span class="token comment" style="color:#999988;font-style:italic"># CentOS/RHEL/Fedora</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="macos">macOS<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#macos" class="hash-link" aria-label="macOS的直接链接" title="macOS的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> gpg</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="windows">Windows<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#windows" class="hash-link" aria-label="Windows的直接链接" title="Windows的直接链接" translate="no">​</a></h3>
<ul>
<li class=""><a href="https://gnupg.org/" target="_blank" rel="noopener noreferrer" class="">GPG</a> 的安装包，<a href="https://gnupg.org/download/index.html" target="_blank" rel="noopener noreferrer" class="">下载地址</a></li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="生成-gpg-密钥">生成 GPG 密钥<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E7%94%9F%E6%88%90-gpg-%E5%AF%86%E9%92%A5" class="hash-link" aria-label="生成 GPG 密钥的直接链接" title="生成 GPG 密钥的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">gpg --full-generate-key</span><br></span></code></pre></div></div>
<ul>
<li class="">选择 RSA 和 DSA</li>
<li class="">选择 1024 - 4096 位</li>
<li class="">选择 0 年（无限期限）</li>
<li class="">姓名：</li>
<li class="">邮箱：</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="其他命令">其他命令<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E5%85%B6%E4%BB%96%E5%91%BD%E4%BB%A4" class="hash-link" aria-label="其他命令的直接链接" title="其他命令的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="发送密钥到公网">发送密钥到公网<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E5%8F%91%E9%80%81%E5%AF%86%E9%92%A5%E5%88%B0%E5%85%AC%E7%BD%91" class="hash-link" aria-label="发送密钥到公网的直接链接" title="发送密钥到公网的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 发送公钥到到服务器</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg </span><span class="token parameter variable" style="color:#36acaa">--keyserver</span><span class="token plain"> hkps://keys.openpgp.org --send-keys </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GPG ID</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 发送到 Ubuntu，我没有成功，我用的 👆 那个</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg </span><span class="token parameter variable" style="color:#36acaa">--keyserver</span><span class="token plain"> hkps://keyserver.ubuntu.com --send-keys </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GPG ID</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="查看生产的-gpg-密钥">查看生产的 GPG 密钥<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E6%9F%A5%E7%9C%8B%E7%94%9F%E4%BA%A7%E7%9A%84-gpg-%E5%AF%86%E9%92%A5" class="hash-link" aria-label="查看生产的 GPG 密钥的直接链接" title="查看生产的 GPG 密钥的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-keys --keyid-format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">long</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-signatures --keyid-format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">long</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-public-keys --keyid-format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">long</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-secret-keys --keyid-format</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">long</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="导出-gpg-密钥">导出 GPG 密钥<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E5%AF%BC%E5%87%BA-gpg-%E5%AF%86%E9%92%A5" class="hash-link" aria-label="导出 GPG 密钥的直接链接" title="导出 GPG 密钥的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">gpg --export-secret-keys </span><span class="token parameter variable" style="color:#36acaa">--armor</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GPG ID</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> private.gpg </span><span class="token comment" style="color:#999988;font-style:italic"># 私钥</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg </span><span class="token parameter variable" style="color:#36acaa">--export</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--armor</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GPG ID</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> public.gpg </span><span class="token comment" style="color:#999988;font-style:italic"># 公钥</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="配置-git-使用-gpg-签名">配置 git 使用 GPG 签名<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E9%85%8D%E7%BD%AE-git-%E4%BD%BF%E7%94%A8-gpg-%E7%AD%BE%E5%90%8D" class="hash-link" aria-label="配置 git 使用 GPG 签名的直接链接" title="配置 git 使用 GPG 签名的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config </span><span class="token parameter variable" style="color:#36acaa">--global</span><span class="token plain"> user.signingkey </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GPG ID</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># &lt;GPG ID&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> config </span><span class="token parameter variable" style="color:#36acaa">--global</span><span class="token plain"> commit.gpgsign </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 提交时使用 GPG 签名</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="添加-gpg-密钥到-github">添加 GPG 密钥到 GitHub<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E6%B7%BB%E5%8A%A0-gpg-%E5%AF%86%E9%92%A5%E5%88%B0-github" class="hash-link" aria-label="添加 GPG 密钥到 GitHub的直接链接" title="添加 GPG 密钥到 GitHub的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">gpg --list-secret-keys --keyid-format LONG</span><br></span></code></pre></div></div>
<ul>
<li class="">找到 GPG 密钥的 ID，复制下来</li>
</ul>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">gpg </span><span class="token parameter variable" style="color:#36acaa">--armor</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--export</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GPG ID</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<ul>
<li class="">复制 GPG 公钥到 GitHub 的 GPG 密钥中</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="验证-gpg-密钥">验证 GPG 密钥<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E9%AA%8C%E8%AF%81-gpg-%E5%AF%86%E9%92%A5" class="hash-link" aria-label="验证 GPG 密钥的直接链接" title="验证 GPG 密钥的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">gpg </span><span class="token parameter variable" style="color:#36acaa">--keyserver</span><span class="token plain"> hkp://keyserver.ubuntu.com --recv-</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">keys </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GPG ID</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">gpg --edit-key </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">GPG ID</span><span class="token operator" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="配置到-npm">配置到 npm<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/GPG%20%E7%AD%BE%E5%90%8D#%E9%85%8D%E7%BD%AE%E5%88%B0-npm" class="hash-link" aria-label="配置到 npm的直接链接" title="配置到 npm的直接链接" translate="no">​</a></h2>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> config </span><span class="token builtin class-name">set</span><span class="token plain"> sign-git-tag </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 提交时使用 GPG 签名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> config </span><span class="token builtin class-name">set</span><span class="token plain"> sign-git-commit </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># 提交时使用 GPG 签名</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre></div></div>]]></content:encoded>
            <category>加密</category>
        </item>
        <item>
            <title><![CDATA[github actions]]></title>
            <link>https://earthnutDev.github.io/日志/github actions</link>
            <guid>https://earthnutDev.github.io/日志/github actions</guid>
            <pubDate>Tue, 11 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用 github actions 自动化部署]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorTargetStickyNavbar_e79m" id="1-核心运行原理">1. 核心运行原理<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#1-%E6%A0%B8%E5%BF%83%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86" class="hash-link" aria-label="1. 核心运行原理的直接链接" title="1. 核心运行原理的直接链接" translate="no">​</a></h2>
<p>GitHub Actions 是 GitHub 提供的 托管式自动化服务，其运行特点如下：
• 按需创建：每次触发工作流程时，GitHub 会在其服务器集群中动态创建虚拟机实例（称为 <code>Runner</code>）
• 环境隔离：每个 Job 都在全新的独立环境中执行，任务完成后销毁实例
• 多系统支持：提供 Linux (Ubuntu)、Windows 和 macOS 三种托管运行环境</p>
<hr>
<!-- -->
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="2-环境配置细节">2. 环境配置细节<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E7%BB%86%E8%8A%82" class="hash-link" aria-label="2. 环境配置细节的直接链接" title="2. 环境配置细节的直接链接" translate="no">​</a></h2>
<table><thead><tr><th>系统类型</th><th>默认镜像</th><th>预装软件</th><th>典型用途</th></tr></thead><tbody><tr><td>Ubuntu</td><td><code>ubuntu-latest</code> (22.04 LTS)</td><td>GCC, Python, Node.js, Docker</td><td>开源项目编译/测试</td></tr><tr><td>Windows</td><td><code>windows-latest</code> (Server 2022)</td><td>PowerShell, .NET, VS Build</td><td>Windows 应用开发</td></tr><tr><td>macOS</td><td><code>macos-latest</code> (12 Monterey)</td><td>Xcode, Homebrew</td><td>iOS/macOS 应用开发</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="3-配置示例显式指定系统">3. 配置示例（显式指定系统）<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#3-%E9%85%8D%E7%BD%AE%E7%A4%BA%E4%BE%8B%E6%98%BE%E5%BC%8F%E6%8C%87%E5%AE%9A%E7%B3%BB%E7%BB%9F" class="hash-link" aria-label="3. 配置示例（显式指定系统）的直接链接" title="3. 配置示例（显式指定系统）的直接链接" translate="no">​</a></h2>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest </span><span class="token comment" style="color:#999988;font-style:italic"># 明确使用 Ubuntu 系统</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> uname </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a </span><span class="token comment" style="color:#999988;font-style:italic"># 输出 Linux 内核信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">windows-test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> windows</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> systeminfo </span><span class="token punctuation" style="color:#393A34">|</span><span class="token plain"> findstr OS </span><span class="token comment" style="color:#999988;font-style:italic"># 查看 Windows 版本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">macos-build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> macos</span><span class="token punctuation" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> sw_vers </span><span class="token comment" style="color:#999988;font-style:italic"># 显示 macOS 版本</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="4-关键技术实现">4. 关键技术实现<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#4-%E5%85%B3%E9%94%AE%E6%8A%80%E6%9C%AF%E5%AE%9E%E7%8E%B0" class="hash-link" aria-label="4. 关键技术实现的直接链接" title="4. 关键技术实现的直接链接" translate="no">​</a></h2>
<p>• 虚拟化技术：基于微软的 Hyper-V (Windows) 和苹果的虚拟化框架 (macOS)
• 网络隔离：每个 Runner 使用独立虚拟网络，默认阻止入站连接
• 缓存机制：通过 <code>actions/cache</code> 优化依赖安装速度
• 跨平台兼容：支持在 Windows Runner 中运行 Linux 容器（基于 WSL2）</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="5-与本地开发环境的差异">5. 与本地开发环境的差异<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#5-%E4%B8%8E%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E7%9A%84%E5%B7%AE%E5%BC%82" class="hash-link" aria-label="5. 与本地开发环境的差异的直接链接" title="5. 与本地开发环境的差异的直接链接" translate="no">​</a></h2>
<table><thead><tr><th>特性</th><th>GitHub Actions Runner</th><th>本地开发机</th></tr></thead><tbody><tr><td>生命周期</td><td>临时（最长 6 小时）</td><td>持久</td></tr><tr><td>硬件配置</td><td>2 核 CPU / 7GB RAM (标准配置)</td><td>自定义</td></tr><tr><td>文件系统</td><td>极速 SSD + 网络存储</td><td>本地磁盘</td></tr><tr><td>网络出口</td><td>共享 GitHub 的 IP 段</td><td>本地运营商 IP</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="6-高级用法">6. 高级用法<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#6-%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95" class="hash-link" aria-label="6. 高级用法的直接链接" title="6. 高级用法的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="自托管运行器self-hosted-runner">自托管运行器（Self-hosted Runner）<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#%E8%87%AA%E6%89%98%E7%AE%A1%E8%BF%90%E8%A1%8C%E5%99%A8self-hosted-runner" class="hash-link" aria-label="自托管运行器（Self-hosted Runner）的直接链接" title="自托管运行器（Self-hosted Runner）的直接链接" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> self</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">hosted </span><span class="token comment" style="color:#999988;font-style:italic"># 使用自己管理的物理机/虚拟机</span><br></span></code></pre></div></div>
<p>• 适用场景：需要 GPU 加速/特殊硬件/内网资源访问
• 管理方式：通过 <code>actions-runner</code> 客户端程序接入</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="矩阵测试多环境并行">矩阵测试（多环境并行）<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#%E7%9F%A9%E9%98%B5%E6%B5%8B%E8%AF%95%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%B9%B6%E8%A1%8C" class="hash-link" aria-label="矩阵测试（多环境并行）的直接链接" title="矩阵测试（多环境并行）的直接链接" translate="no">​</a></h3>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">strategy</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">matrix</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">os</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> windows</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> macos</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> matrix.os </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="7-监控与调试">7. 监控与调试<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#7-%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%B0%83%E8%AF%95" class="hash-link" aria-label="7. 监控与调试的直接链接" title="7. 监控与调试的直接链接" translate="no">​</a></h2>
<p>• 实时日志：在 GitHub 仓库的 Actions 标签页查看
• SSH 调试（需企业版）：通过 <code>actions/runner/debug</code> 接入
• 性能分析：使用 <code>Benchmark Action</code> 测量各步骤耗时</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="总结">总结<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#%E6%80%BB%E7%BB%93" class="hash-link" aria-label="总结的直接链接" title="总结的直接链接" translate="no">​</a></h2>
<p>GitHub Actions 本质上是按需创建的 临时云虚拟机，通过声明式配置实现跨平台自动化任务。开发者无需关心底层基础设施，只需专注业务流程设计。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="与本地开发的区别">与本地开发的区别<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#%E4%B8%8E%E6%9C%AC%E5%9C%B0%E5%BC%80%E5%8F%91%E7%9A%84%E5%8C%BA%E5%88%AB" class="hash-link" aria-label="与本地开发的区别的直接链接" title="与本地开发的区别的直接链接" translate="no">​</a></h2>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="触发器">触发器<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#%E8%A7%A6%E5%8F%91%E5%99%A8" class="hash-link" aria-label="触发器的直接链接" title="触发器的直接链接" translate="no">​</a></h2>
<p>触发器分为两种：</p>
<ul>
<li class=""><code>workflow_dispatch</code>：手动触发，需要手动输入参数</li>
<li class=""><code>push</code>：自动触发，当有代码提交时触发</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="示例">示例<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/github%20actions#%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="示例的直接链接" title="示例的直接链接" translate="no">​</a></h2>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">workflow_dispatch</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">inputs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">build_type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Build type'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">required</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Debug'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> choice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">description</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'Build options'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">required</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">default</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--build-tests'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">type</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> choice</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--build-tests'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--no-build-tests'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--build-examples'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--no-build-examples'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--build-docs'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--no-build-docs'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--build-tools'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'--no-build-tools'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">build</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Build</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">|</span><span class="token scalar string" style="color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          cmake -S . -B build -DCMAKE_BUILD_TYPE=${{ inputs.build_type }} ${{ inputs.options }}</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          cmake --build build</span><br></span><span class="token-line" style="color:#393A34"><span class="token scalar string" style="color:#e3116c">          cmake --build build --target test</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>自动化</category>
        </item>
        <item>
            <title><![CDATA[测试覆盖率]]></title>
            <link>https://earthnutDev.github.io/日志/测试覆盖率</link>
            <guid>https://earthnutDev.github.io/日志/测试覆盖率</guid>
            <pubDate>Mon, 10 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[使用 Coverage、Codecov 或 SonarCloud 生成测试覆盖率]]></description>
            <content:encoded><![CDATA[<p>测试覆盖率是测试代码的质量，它表示代码被测试的百分比。</p>
<p>在系统学习构建 npm 包时，发现在推荐的徽章展示中包含测试覆盖率的徽章，有助于帮助用户了解代码的质量。</p>
<p>但是貌似遇见了我的知识盲区，遂学且记之。</p>
<!-- -->
<h2>🔧</h2>
<table><thead><tr><th>🔧</th><th>特点</th></tr></thead><tbody><tr><td><a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">Coveralls</a></td><td>支持多种语言，与 github 集成简单，适合开源项目</td></tr><tr><td><a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">codecov</a></td><td>支持 更详细的报告分析，适合复杂的项目</td></tr><tr><td>SonarCloud</td><td>提供代码质量 + 覆盖率综合报告，适合企业级的项目</td></tr></tbody></table>
<p>这里以 <a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">coveralls</a> 及 <a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">codecov</a> 为例。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="-coveralls">🔧 <a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">Coveralls</a><a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#-coveralls" class="hash-link" aria-label="-coveralls的直接链接" title="-coveralls的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="1-安装">1. 安装<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#1-%E5%AE%89%E8%A3%85" class="hash-link" aria-label="1. 安装的直接链接" title="1. 安装的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev jest jest-junit coveralls </span><span class="token comment" style="color:#999988;font-style:italic"># 生成 JUnit 格式测试报告</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev ts-jest ts-node @types/jest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev jest-environment-jsdom</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="2-配置">2. 配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#2-%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="2. 配置的直接链接" title="2. 配置的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="在-packagejson-文件中添加-scripts-配置">在 <code>package.json</code> 文件中添加 <code>scripts</code> 配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E5%9C%A8-packagejson-%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0-scripts-%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="在-packagejson-文件中添加-scripts-配置的直接链接" title="在-packagejson-文件中添加-scripts-配置的直接链接" translate="no">​</a></h4>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">package.json</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"jest --coverage"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"report"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"cat ./coverage/lcov.info | coveralls"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="在-jestconfigjs-文件中添加配置">在 <code>jest.config.js</code> 文件中添加配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E5%9C%A8-jestconfigjs-%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="在-jestconfigjs-文件中添加配置的直接链接" title="在-jestconfigjs-文件中添加配置的直接链接" translate="no">​</a></h4>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--eval</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">"fs.mkdirSync('.github/workflows', { recursive: true })"</span><br></span></code></pre></div></div>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">jest.config.js</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">collectCoverage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">coverageDirectory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'coverage'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">coverageReporters</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'lcov'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'text-summary'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">collectCoverageFrom</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'src/**/*.{js,jsx}'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'!**/node_modules/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'!**/vendor/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="github-actions-配置">github actions 配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#github-actions-%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="github actions 配置的直接链接" title="github actions 配置的直接链接" translate="no">​</a></h4>
<p>创建（已有可修改）.github/workflows/coverage.yml 文件</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"fs.mkdirSync('.github/workflows/', { recursive: true })"</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">.github/workflows/coverage.yml</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests and upload coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># tags: ['*']</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests and collect coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 仅当提交消息包含 "version" 时运行自动化测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 'version')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">fetch-depth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set up Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">node-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npx jest </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copy coverage to test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">coverage directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> coverallsapp/github</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">github-token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.GITHUB_TOKEN</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic"># ${{ secrets.COVERALLS_REPO_TOKEN }}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path-to-lcov</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./coverage/lcov.info</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="3-coveralls-集成">3. coveralls 集成<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#3-coveralls-%E9%9B%86%E6%88%90" class="hash-link" aria-label="3. coveralls 集成的直接链接" title="3. coveralls 集成的直接链接" translate="no">​</a></h3>
<ul>
<li class="">获取 token（开源仓库可以使用 <code>GITHUB_TOKEN</code> 代替）<!-- -->
<ul>
<li class="">登录 [<a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">https://coveralls.io/</a>]</li>
<li class="">点击 <code>Add Repo</code> 按钮，添加仓库</li>
<li class="">获取 COVERALLS_REPO_TOKEN (自动生成)</li>
</ul>
</li>
<li class="">配置 github secrets<!-- -->
<ul>
<li class="">在 Settings ➡️ secrets ➡️ Actions 添加： <code>COVERALLS_REPO_TOKEN: &lt;your_token&gt;</code></li>
</ul>
</li>
</ul>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">COVERALLS_REPO_TOKEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;your</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="4-本地调试命令">4. 本地调试命令<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#4-%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95%E5%91%BD%E4%BB%A4" class="hash-link" aria-label="4. 本地调试命令的直接链接" title="4. 本地调试命令的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">COVERALLS_REPO_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">your_token </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> run report</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="5-测试覆盖率报告">5. 测试覆盖率报告<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#5-%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87%E6%8A%A5%E5%91%8A" class="hash-link" aria-label="5. 测试覆盖率报告的直接链接" title="5. 测试覆盖率报告的直接链接" translate="no">​</a></h3>
<p>下面是 <a href="https://www.npmjs.com/a-type-of-js" target="_blank" rel="noopener noreferrer" class="">a-type-of-js</a> 的 <a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">coveralls</a> 测试覆盖率报告 <a href="https://coveralls.io/github/earthnutDev/a-type-of-js?branch=main" target="_blank" rel="noopener noreferrer" class=""><img alt="Coverage Status" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="-codecov">🔧 <a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">Codecov</a><a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#-codecov" class="hash-link" aria-label="-codecov的直接链接" title="-codecov的直接链接" translate="no">​</a></h2>
<p><a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">Codecov</a> 是一个开源的代码覆盖率平台，它提供了详细的报告分析，适合复杂的项目。
<a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">Codecov</a> 支持多种语言，包括 JavaScript、Python、Ruby、Java、C++、C#、Go、Swift、Kotlin、Rust、PHP、R、Scala、Perl、Lua、Erlang、Haskell、OCaml、Clojure、Elixir、Pascal、Dart、Racket、Lisp、Fortran、Ada、Prolog、VBScript、VBA、Visual Basic、Objective-C、Objective-C++、Assembly、C。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="1-安装-1">1. 安装<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#1-%E5%AE%89%E8%A3%85-1" class="hash-link" aria-label="1. 安装的直接链接" title="1. 安装的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev jest jest-junit codecov </span><span class="token comment" style="color:#999988;font-style:italic"># 生成 JUnit 格式测试报告</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev ts-jest ts-node @types/jest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev jest-environment-jsdom</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="2-配置-1">2. 配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#2-%E9%85%8D%E7%BD%AE-1" class="hash-link" aria-label="2. 配置的直接链接" title="2. 配置的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="在-packagejson-文件中添加-scripts-配置-1">在 <code>package.json</code> 文件中添加 <code>scripts</code> 配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E5%9C%A8-packagejson-%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0-scripts-%E9%85%8D%E7%BD%AE-1" class="hash-link" aria-label="在-packagejson-文件中添加-scripts-配置-1的直接链接" title="在-packagejson-文件中添加-scripts-配置-1的直接链接" translate="no">​</a></h4>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">package.json</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"jest --coverage"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"coverage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"codecov"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="在-jestconfigjs-文件中添加配置-同-coveralls">在 <code>jest.config.js</code> 文件中添加配置 (同 <a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">coveralls</a>)<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E5%9C%A8-jestconfigjs-%E6%96%87%E4%BB%B6%E4%B8%AD%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE-%E5%90%8C-coveralls" class="hash-link" aria-label="在-jestconfigjs-文件中添加配置-同-coveralls的直接链接" title="在-jestconfigjs-文件中添加配置-同-coveralls的直接链接" translate="no">​</a></h4>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">jest.config.js</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">collectCoverage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">coverageDirectory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'coverage'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">coverageReporters</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'lcov'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'text-summary'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">collectCoverageFrom</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'src/**/*.{js,jsx}'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'!**/node_modules/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">'!**/vendor/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_e79m" id="github-actions-配置-1">github actions 配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#github-actions-%E9%85%8D%E7%BD%AE-1" class="hash-link" aria-label="github actions 配置的直接链接" title="github actions 配置的直接链接" translate="no">​</a></h4>
<p>创建（已有可修改）.github/workflows/coverage.yml 文件</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"fs.mkdirSync('.github/workflows/', { recursive: true })"</span><br></span></code></pre></div></div>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">.github/workflows/coverage.yml</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests and upload coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># tags: ['*']</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests and collect coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># 仅当提交消息包含 "version" 时运行自动化测试</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 'version')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">fetch-depth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set up Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">node-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npx jest </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Upload results to Codecov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> codecov/codecov</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># token: ${{ secrets.CODECOV_TOKEN }} # 仅私人仓库需要</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./coverage/lcov.info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">verbose</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="3-codecov-集成">3. codecov 集成<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#3-codecov-%E9%9B%86%E6%88%90" class="hash-link" aria-label="3. codecov 集成的直接链接" title="3. codecov 集成的直接链接" translate="no">​</a></h3>
<ul>
<li class="">获取 <code>token</code>（公开仓库可以省略 <code>token</code>）<!-- -->
<ul>
<li class="">登录 <a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">codecov</a></li>
<li class="">点击 <code>Add Repo</code> 按钮，添加仓库</li>
<li class="">获取 CODECOV_TOKEN (自动生成)</li>
</ul>
</li>
<li class="">配置 github secrets<!-- -->
<ul>
<li class="">在 Settings ➡️ secrets ➡️ Actions 添加： <code>CODECOV_TOKEN: &lt;your_token&gt;</code></li>
</ul>
</li>
</ul>
<div class="language-yaml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yaml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">CODECOV_TOKEN</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> &lt;your</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">token</span><span class="token punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="4-本地调试命令-1">4. 本地调试命令<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#4-%E6%9C%AC%E5%9C%B0%E8%B0%83%E8%AF%95%E5%91%BD%E4%BB%A4-1" class="hash-link" aria-label="4. 本地调试命令的直接链接" title="4. 本地调试命令的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">CODECOV_TOKEN</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">your_token </span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> run coverage</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="5-测试覆盖率报告-1">5. 测试覆盖率报告<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#5-%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87%E6%8A%A5%E5%91%8A-1" class="hash-link" aria-label="5. 测试覆盖率报告的直接链接" title="5. 测试覆盖率报告的直接链接" translate="no">​</a></h3>
<p>下面是 <a href="https://www.npmjs.com/a-type-of-js" target="_blank" rel="noopener noreferrer" class="">a-type-of-js</a> 的 <a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">codecov</a> 测试覆盖率报告 <a href="https://codecov.io/gh/earthnutDev/a-type-of-js" target="_blank" rel="noopener noreferrer" class=""><img alt="codecov" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa"></a></p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="完整的示例">完整的示例<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E5%AE%8C%E6%95%B4%E7%9A%84%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="完整的示例的直接链接" title="完整的示例的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="安装">安装<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E5%AE%89%E8%A3%85" class="hash-link" aria-label="安装的直接链接" title="安装的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev jest jest-junit coveralls codecov </span><span class="token comment" style="color:#999988;font-style:italic"># 生成 JUnit 格式测试报告</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev ts-jest ts-node @types/jest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev jest-environment-jsdom</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置-jestconfigjs">配置 jest.config.js<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E9%85%8D%E7%BD%AE-jestconfigjs" class="hash-link" aria-label="配置 jest.config.js的直接链接" title="配置 jest.config.js的直接链接" translate="no">​</a></h3>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">jest.config.js</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token doc-comment comment" style="color:#999988;font-style:italic">/** </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@type</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">{</span><span class="token doc-comment comment class-name keyword" style="color:#00009f;font-style:italic">import</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">(</span><span class="token doc-comment comment class-name string" style="color:#e3116c;font-style:italic">'ts-jest'</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">)</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">.</span><span class="token doc-comment comment class-name" style="color:#999988;font-style:italic">JestConfigWithTsJest</span><span class="token doc-comment comment class-name punctuation" style="color:#393A34;font-style:italic">}</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> **/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword module" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#00009f">default</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#00009f">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">collectCoverage</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">collectCoverageFrom</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'index.ts'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'!**/node_modules/**'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'!**/vendor/**'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">coveragePathIgnorePatterns</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'/node_modules/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'/dist/'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'test'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'.*.d.ts'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">coverageReporters</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'text'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'lcov'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'html'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'text-summary'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">coverageDirectory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'coverage'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">preset</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'ts-jest'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">verbose</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">testEnvironment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'node'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">transform</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token string-property property" style="color:#36acaa">'^.+\\.tsx?$'</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">'ts-jest'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">isolatedModules</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token literal-property property" style="color:#36acaa">tsconfig</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'tsconfig.json'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token literal-property property" style="color:#36acaa">testMatch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'**/*.test.(js|ts|tsx)'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置-packagejson">配置 package.json<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E9%85%8D%E7%BD%AE-packagejson" class="hash-link" aria-label="配置 package.json的直接链接" title="配置 package.json的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">package.json</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"jest --coverage"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"report"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"cat ./coverage/lcov.info | coveralls"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"coverage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"codecov"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="集成-codecovcoveralls">集成 <a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">codecov</a>、<a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">coveralls</a><a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E9%9B%86%E6%88%90-codecovcoveralls" class="hash-link" aria-label="集成-codecovcoveralls的直接链接" title="集成-codecovcoveralls的直接链接" translate="no">​</a></h3>
<ul>
<li class="">使用 github 账号分别登录 <a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">codecov</a>、<a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">coveralls</a></li>
<li class="">添加仓库</li>
<li class="">获取 token （非私人仓库可以省略 <code>token</code>）</li>
<li class="">配置 github secrets</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="最终的-coverageyml">最终的 coverage.yml<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E6%9C%80%E7%BB%88%E7%9A%84-coverageyml" class="hash-link" aria-label="最终的 coverage.yml的直接链接" title="最终的 coverage.yml的直接链接" translate="no">​</a></h3>
<!-- -->
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">node</span><span class="token plain"> </span><span class="token parameter variable" style="color:#36acaa">--eval</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"fs.mkdirSync('.github/workflows/', { recursive: true })"</span><br></span></code></pre></div></div>
<div class="language-yml codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">.github/workflows/coverage.yml</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-yml codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests and upload coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">push</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">branches</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">main</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">jobs</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">test</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests and collect coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">runs-on</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ubuntu</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">if</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> contains(github.event.head_commit.message</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 'version')</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">steps</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Checkout</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/checkout@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">fetch-depth</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Set up Node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> actions/setup</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node@v4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">node-version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 20.x</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Install dependencies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npm install</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Run tests</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">run</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> npx jest </span><span class="token punctuation" style="color:#393A34">-</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">coverage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Upload results to Codecov</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> codecov/codecov</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># token: ${{ secrets.CODECOV_TOKEN }}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">files</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./coverage/lcov.info</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">verbose</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> copy coverage to test</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">coverage directory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">uses</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> coverallsapp/github</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">action@v2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">with</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">github-token</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> $</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> secrets.GITHUB_TOKEN </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">path-to-lcov</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ./coverage/lcov.info</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="参考资料">参考资料<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E6%B5%8B%E8%AF%95%E8%A6%86%E7%9B%96%E7%8E%87#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99" class="hash-link" aria-label="参考资料的直接链接" title="参考资料的直接链接" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://coveralls.io/" target="_blank" rel="noopener noreferrer" class="">Coveralls</a></li>
<li class=""><a href="https://codecov.io/" target="_blank" rel="noopener noreferrer" class="">Codecov</a></li>
<li class=""><a href="https://www.npmjs.com/a-type-of-js" target="_blank" rel="noopener noreferrer" class="">a-type-of-js</a></li>
</ul>]]></content:encoded>
            <category>测试</category>
        </item>
        <item>
            <title><![CDATA[npm 包其他构建]]></title>
            <link>https://earthnutDev.github.io/日志/npm 包构建其他</link>
            <guid>https://earthnutDev.github.io/日志/npm 包构建其他</guid>
            <pubDate>Sun, 09 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[构建 npm 包时还需要考虑的其他方面]]></description>
            <content:encoded><![CDATA[<p>一个基本包在构建时还需要考虑的其他方面的内容。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="模块化与架构设计">模块化与架构设计<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E6%A8%A1%E5%9D%97%E5%8C%96%E4%B8%8E%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1" class="hash-link" aria-label="模块化与架构设计的直接链接" title="模块化与架构设计的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="模块化分割">模块化分割<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E6%A8%A1%E5%9D%97%E5%8C%96%E5%88%86%E5%89%B2" class="hash-link" aria-label="模块化分割的直接链接" title="模块化分割的直接链接" translate="no">​</a></h3>
<ul>
<li class="">按功能划分：将核心逻辑、业务逻辑、工具函数等，分别打包到不同的模块中，方便维护和复用。</li>
<li class="">支持插件系统：允许用户自定义插件，实现对不同环境、不同场景的兼容。</li>
</ul>
<!-- -->
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">MyPackage</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">constructor</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// 初始化</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 业务逻辑</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">doSomething</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 工具函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">utils</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 插件系统</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">plugin</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="多环境兼容">多环境兼容<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E5%A4%9A%E7%8E%AF%E5%A2%83%E5%85%BC%E5%AE%B9" class="hash-link" aria-label="多环境兼容的直接链接" title="多环境兼容的直接链接" translate="no">​</a></h3>
<p>输出多种格式，如： <code>ESM</code>、<code>CJS</code>、<code>UMD</code>、<code>IIFE</code></p>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">package.json</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"main"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./dist/index.cjs"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// CommonJS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"module"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./dist/index.esm.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// ESM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"browser"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./dist/index.umd.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// 浏览器环境</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"types"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./dist/index.d.ts"</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// TypeScript 类型定义</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="tree-shaking-优化">tree Shaking 优化<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#tree-shaking-%E4%BC%98%E5%8C%96" class="hash-link" aria-label="tree Shaking 优化的直接链接" title="tree Shaking 优化的直接链接" translate="no">​</a></h3>
<p>在 <code>package.json</code> 中配置 <code>sideEffects</code> 属性，来告诉 <code>webpack</code> 在构建过程中，哪些文件可以安全地被 tree shaking。</p>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockTitle_ezoU">package.json</div><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"sideEffects"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="文档和示例">文档和示例<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E6%96%87%E6%A1%A3%E5%92%8C%E7%A4%BA%E4%BE%8B" class="hash-link" aria-label="文档和示例的直接链接" title="文档和示例的直接链接" translate="no">​</a></h2>
<ul>
<li class="">提供文档：包括使用说明、示例代码、API 文档等，帮助用户快速上手和了解如何使用。</li>
<li class="">提供示例：提供示例代码，帮助用户快速了解如何使用。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="自动化文档生成">自动化文档生成<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E8%87%AA%E5%8A%A8%E5%8C%96%E6%96%87%E6%A1%A3%E7%94%9F%E6%88%90" class="hash-link" aria-label="自动化文档生成的直接链接" title="自动化文档生成的直接链接" translate="no">​</a></h3>
<ul>
<li class="">工具选择：如 <code>typedoc</code>、<code>jsdoc</code> 等。</li>
<li class="">配置：根据项目实际情况进行配置，确保生成的文档符合要求。</li>
<li class="">持续集成：在每次构建时，自动生成文档，并保存到仓库中，以便随时查阅。</li>
<li class="">托管文档：通过 GitHub Pages、GitLab Pages 等服务托管文档，便于用户访问。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="示例代码">示例代码<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="示例代码的直接链接" title="示例代码的直接链接" translate="no">​</a></h3>
<ul>
<li class="">提供示例代码：包括完整的示例代码，帮助用户快速了解如何使用。</li>
<li class="">创建 CodeSandbox：使用 CodeSandbox 或 StackBlitz 等类似工具，创建示例代码，方便用户在线调试和查看。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="readme-规范">README 规范<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#readme-%E8%A7%84%E8%8C%83" class="hash-link" aria-label="README 规范的直接链接" title="README 规范的直接链接" translate="no">​</a></h3>
<ul>
<li class="">必要的内容：安装说明、快速上手、API 文档、贡献指南、许可证</li>
<li class="">徽章：显示测试覆盖率、版本号、下载量等</li>
</ul>
<p>示例：</p>
<div class="language-markdown codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-markdown codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token url operator" style="color:#393A34">!</span><span class="token url" style="color:#36acaa">[</span><span class="token url content" style="color:#36acaa">version</span><span class="token url" style="color:#36acaa">](</span><span class="token url" style="color:#36acaa">&lt;https://img.shields.io/npm/v/a-type-of-js.svg?logo=npm&amp;logoColor=rgb(0,0,0</span><span class="token url" style="color:#36acaa">)</span><span class="token plain">&amp;label=version&amp;labelColor=rgb(73,73,228)&amp;color=rgb(0,0,0)&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token url operator" style="color:#393A34">!</span><span class="token url" style="color:#36acaa">[</span><span class="token url content" style="color:#36acaa">NPM Last Update</span><span class="token url" style="color:#36acaa">](</span><span class="token url" style="color:#36acaa">&lt;https://img.shields.io/npm/last-update/a-type-of-js?logo=npm&amp;labelColor=rgb(255,36,63</span><span class="token url" style="color:#36acaa">)</span><span class="token plain">&amp;color=rgb(0,0,0)&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token url operator" style="color:#393A34">!</span><span class="token url" style="color:#36acaa">[</span><span class="token url content" style="color:#36acaa">📦 size</span><span class="token url" style="color:#36acaa">](</span><span class="token url" style="color:#36acaa">&lt;https://img.shields.io/bundlephobia/minzip/a-type-of-js.svg?logo=npm&amp;labelColor=rgb(201,158,140</span><span class="token url" style="color:#36acaa">)</span><span class="token plain">&amp;color=rgb(0,0,0)&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token url operator" style="color:#393A34">!</span><span class="token url" style="color:#36acaa">[</span><span class="token url content" style="color:#36acaa">downloads</span><span class="token url" style="color:#36acaa">](</span><span class="token url" style="color:#36acaa">&lt;https://img.shields.io/npm/dm/a-type-of-js.svg?logo=npm&amp;logoColor=rgb(0,0,0</span><span class="token url" style="color:#36acaa">)</span><span class="token plain">&amp;labelColor=rgb(194,112,210)&amp;color=rgb(0,0,0)&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token url operator" style="color:#393A34">!</span><span class="token url" style="color:#36acaa">[</span><span class="token url content" style="color:#36acaa">downloads</span><span class="token url" style="color:#36acaa">](</span><span class="token url" style="color:#36acaa">&lt;https://img.shields.io/npm/dt/a-type-of-js.svg?logo=npm&amp;labelColor=rgb(107,187,124</span><span class="token url" style="color:#36acaa">)</span><span class="token plain">&amp;color=rgb(0,0,0)&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token url operator" style="color:#393A34">!</span><span class="token url" style="color:#36acaa">[</span><span class="token url content" style="color:#36acaa">last commit</span><span class="token url" style="color:#36acaa">](</span><span class="token url" style="color:#36acaa">&lt;https://img.shields.io/github/last-commit/earthnutDev/a-type-of-js.svg?logo=github&amp;logoColor=rgb(0,0,0</span><span class="token url" style="color:#36acaa">)</span><span class="token plain">&amp;labelColor=rgb(255,165,0)&amp;color=rgb(0,0,0)&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token url operator" style="color:#393A34">!</span><span class="token url" style="color:#36acaa">[</span><span class="token url content" style="color:#36acaa">GitHub commit activity</span><span class="token url" style="color:#36acaa">](</span><span class="token url" style="color:#36acaa">&lt;https://img.shields.io/github/commit-activity/y/earthnutDev/a-type-of-js.svg?logo=github&amp;labelColor=rgb(128,0,128</span><span class="token url" style="color:#36acaa">)</span><span class="token plain">&amp;color=rgb(0,0,0)&gt;)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token url operator" style="color:#393A34">!</span><span class="token url" style="color:#36acaa">[</span><span class="token url content" style="color:#36acaa">test coverage</span><span class="token url" style="color:#36acaa">](</span><span class="token url" style="color:#36acaa">&lt;https://img.shields.io/codecov/c/gh/earthnutDev/a-type-of-js.svg?logo=codecov&amp;labelColor=rgb(0,0,0</span><span class="token url" style="color:#36acaa">)</span><span class="token plain">&amp;color=rgb(0,0,0)&gt;)</span><br></span></code></pre></div></div>
<p>效果展示：</p>
<p><img alt="version" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa">
<img alt="NPM Last Update" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa">
<img alt="📦 size" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa">
<img alt="downloads" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa">
<img alt="downloads" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa"></p>
<p><img alt="last commit" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa">
<img alt="GitHub commit activity" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa">
<img alt="test coverage" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAQAAAAECAMAAACeL25MAAAACVBMVEUAAAD///////9zeKVjAAAAA3RSTlP//wDXyg1BAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAEElEQVQImWNkYmBgYGJAIQAAigAKNDhFkwAAAABJRU5ErkJggg==" class="image__Content-sc-qt83ib-0 CuTpa"></p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="版本管理与发布">版本管理与发布<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E4%B8%8E%E5%8F%91%E5%B8%83" class="hash-link" aria-label="版本管理与发布的直接链接" title="版本管理与发布的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="语义话版本管理">语义话版本管理<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E8%AF%AD%E4%B9%89%E8%AF%9D%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86" class="hash-link" aria-label="语义话版本管理的直接链接" title="语义话版本管理的直接链接" translate="no">​</a></h3>
<p>语义化版本管理：使用语义化版本管理，如 <code>SemVer</code>，以 <code>major.minor.patch</code> 的形式进行版本管理。</p>
<ul>
<li class="">major : 不兼容的 API 变更</li>
<li class="">minor : 添加新的功能，不破坏现有 API 的功能</li>
<li class="">patch : 修复 bug，不破坏现有 API 的功能</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="自动化发布">自动化发布<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E8%87%AA%E5%8A%A8%E5%8C%96%E5%8F%91%E5%B8%83" class="hash-link" aria-label="自动化发布的直接链接" title="自动化发布的直接链接" translate="no">​</a></h3>
<p>使用工具 <code>standard-version</code> 或 <code>semantic-release</code> 自动化版本管理，并使用 <code>npm publish</code> 发布包。</p>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"release"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"standard-version &amp;&amp; git push --follow-tags &amp;&amp; npm publish"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="版本回退">版本回退<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E7%89%88%E6%9C%AC%E5%9B%9E%E9%80%80" class="hash-link" aria-label="版本回退的直接链接" title="版本回退的直接链接" translate="no">​</a></h3>
<p>在发布过程中，如果发现版本号错误，可以使用 <code>npm deprecate</code> 进行版本回退，并在文档中说明替代方案。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="依赖与安全">依赖与安全<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E4%BE%9D%E8%B5%96%E4%B8%8E%E5%AE%89%E5%85%A8" class="hash-link" aria-label="依赖与安全的直接链接" title="依赖与安全的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="依赖优化">依赖优化<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E4%BE%9D%E8%B5%96%E4%BC%98%E5%8C%96" class="hash-link" aria-label="依赖优化的直接链接" title="依赖优化的直接链接" translate="no">​</a></h3>
<ul>
<li class="">
<p>避免使用过时的依赖：使用最新、安全的依赖，避免使用过时的依赖。</p>
</li>
<li class="">
<p>避免使用开发依赖：开发依赖只用于开发阶段，发布时无需包含。</p>
</li>
<li class="">
<p>避免使用重复依赖：避免重复依赖，使用统一的依赖管理工具进行依赖管理。</p>
</li>
<li class="">
<p>生产依赖（dependencies）： 仅保留运行时必须的包</p>
</li>
<li class="">
<p>开发依赖（devDependencies）：构建、测试、格式化、文档、自动化等工具</p>
</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="安全性">安全性<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E5%AE%89%E5%85%A8%E6%80%A7" class="hash-link" aria-label="安全性的直接链接" title="安全性的直接链接" translate="no">​</a></h3>
<ul>
<li class="">避免使用不安全的依赖：使用安全的依赖，避免使用不安全的依赖。</li>
<li class="">避免使用不安全的插件：使用安全的插件，避免使用不安全的插件。</li>
<li class="">使用 <code>npm audit</code> 进行依赖漏洞扫描，并使用 <code>npm audit fix</code> 进行修复。</li>
<li class="">使用 <code>npm shrinkwrap</code> 进行依赖锁定，以防止依赖版本升级带来的问题。</li>
<li class="">使用 <code>npm dedupe</code> 进行依赖树优化，减少重复依赖。</li>
<li class="">使用 <code>npm prune</code> 进行依赖清理，删除未使用的依赖。</li>
<li class="">使用 <code>npm cache clean</code> 进行缓存清理，避免缓存影响构建结果。</li>
<li class="">使用 <code>npm update</code> 进行依赖更新，以获取最新版本的依赖。</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="用户体验增强">用户体验增强<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E7%94%A8%E6%88%B7%E4%BD%93%E9%AA%8C%E5%A2%9E%E5%BC%BA" class="hash-link" aria-label="用户体验增强的直接链接" title="用户体验增强的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="类型声明">类型声明<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E7%B1%BB%E5%9E%8B%E5%A3%B0%E6%98%8E" class="hash-link" aria-label="类型声明的直接链接" title="类型声明的直接链接" translate="no">​</a></h3>
<p>提供 <code>.d.ts</code> 文件，用于提供类型声明，以增强用户体验。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="错误处理">错误处理<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86" class="hash-link" aria-label="错误处理的直接链接" title="错误处理的直接链接" translate="no">​</a></h3>
<ul>
<li class="">自定义错误类型：帮助用户或自己快速地处理错误，避免用户 sightseeing</li>
<li class="">输入验证：一行代码写功能，百行代码防刁民</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="性能优化">性能优化<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96" class="hash-link" aria-label="性能优化的直接链接" title="性能优化的直接链接" translate="no">​</a></h3>
<ul>
<li class="">使用 <code>webpack</code> 或 <code>rollup</code> 进行打包，以减少包体积。</li>
<li class="">使用 <code>lodash</code> 或 <code>ramda</code> 等工具库，以减少重复代码。</li>
<li class="">使用 <code>babel</code> 或 <code>swc</code> 进行编译，以减少编译时间。</li>
<li class="">使用 <code>tree-shaking</code> 进行摇掉无用的代码。</li>
<li class="">使用 <code>lazy loading</code> 进行懒加载，以减少首屏加载时间。</li>
<li class="">使用 <code>async/await</code> 或 <code>generator</code> 进行异步编程，以减少回调嵌套。</li>
<li class="">使用 <code>benchmark</code> 库进行性能测试，以确定代码性能。</li>
<li class="">避免阻塞主进程（Node.js 使用 <code>worker_threads</code>，浏览器环境使用 <code>web worker</code>）</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="社区与协作">社区与协作<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E7%A4%BE%E5%8C%BA%E4%B8%8E%E5%8D%8F%E4%BD%9C" class="hash-link" aria-label="社区与协作的直接链接" title="社区与协作的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="贡献指南">贡献指南<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E8%B4%A1%E7%8C%AE%E6%8C%87%E5%8D%97" class="hash-link" aria-label="贡献指南的直接链接" title="贡献指南的直接链接" translate="no">​</a></h3>
<ul>
<li class="">创建 <code>CONTRIBUTING.md</code> 文件，以描述如何贡献代码。</li>
<li class="">创建 <code>PULL_REQUEST_TEMPLATE.md</code> 文件，以描述拉取请求模板。</li>
<li class="">创建 <code>ISSUE_TEMPLATE.md</code> 文件，以描述问题模板。</li>
<li class="">创建 <code>SECURITY.md</code> 文件，以描述安全漏洞处理流程。</li>
<li class="">创建 <code>CHANGELOG.md</code> 文件，以记录版本更新日志。</li>
<li class="">创建 <code>LICENSE.md</code> 文件，以描述开源协议。</li>
<li class="">创建 <code>README.md</code> 文件，以描述项目简介。</li>
<li class="">创建 <code>CONTRIBUTORS.md</code> 文件，以记录贡献者名单。</li>
<li class="">提供 Issue 模板，以帮助用户提交问题。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="行为规范">行为规范<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E8%A1%8C%E4%B8%BA%E8%A7%84%E8%8C%83" class="hash-link" aria-label="行为规范的直接链接" title="行为规范的直接链接" translate="no">​</a></h3>
<ul>
<li class="">创建 <code>CODE_OF_CONDUCT.md</code> 文件，以描述社区行为规范。</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="多语言支持">多语言支持<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E5%A4%9A%E8%AF%AD%E8%A8%80%E6%94%AF%E6%8C%81" class="hash-link" aria-label="多语言支持的直接链接" title="多语言支持的直接链接" translate="no">​</a></h3>
<p>如果面向国际化用户，提供多语言的文档和错误信息</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="扩展性设计">扩展性设计<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E6%89%A9%E5%B1%95%E6%80%A7%E8%AE%BE%E8%AE%A1" class="hash-link" aria-label="扩展性设计的直接链接" title="扩展性设计的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置文件支持">配置文件支持<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%94%AF%E6%8C%81" class="hash-link" aria-label="配置文件支持的直接链接" title="配置文件支持的直接链接" translate="no">​</a></h3>
<p>允许用户通过配置文件进行配置，以增强用户体验。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="声明周期-">声明周期 🪝<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E5%A3%B0%E6%98%8E%E5%91%A8%E6%9C%9F-" class="hash-link" aria-label="声明周期 🪝的直接链接" title="声明周期 🪝的直接链接" translate="no">​</a></h3>
<p>暴露 🪝 函数，供用户扩展</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="插件生态">插件生态<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E6%8F%92%E4%BB%B6%E7%94%9F%E6%80%81" class="hash-link" aria-label="插件生态的直接链接" title="插件生态的直接链接" translate="no">​</a></h3>
<p>提供插件开发文档和示例，鼓励社区贡献插件</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="监控与维护">监控与维护<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E7%9B%91%E6%8E%A7%E4%B8%8E%E7%BB%B4%E6%8A%A4" class="hash-link" aria-label="监控与维护的直接链接" title="监控与维护的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="使用统计">使用统计<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E4%BD%BF%E7%94%A8%E7%BB%9F%E8%AE%A1" class="hash-link" aria-label="使用统计的直接链接" title="使用统计的直接链接" translate="no">​</a></h3>
<p>可匿名 📉，了解功能使用情况</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="维护模式">维护模式<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E7%BB%B4%E6%8A%A4%E6%A8%A1%E5%BC%8F" class="hash-link" aria-label="维护模式的直接链接" title="维护模式的直接链接" translate="no">​</a></h3>
<p>如果项目进入维护期，在文档和 README 中添加维护模式说明</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="弃用策略">弃用策略<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%85%B6%E4%BB%96#%E5%BC%83%E7%94%A8%E7%AD%96%E7%95%A5" class="hash-link" aria-label="弃用策略的直接链接" title="弃用策略的直接链接" translate="no">​</a></h3>
<p>提前告知用户即将废弃的功能，并给出替代方案</p>]]></content:encoded>
            <category>npm 包</category>
        </item>
        <item>
            <title><![CDATA[npm 包基础构建]]></title>
            <link>https://earthnutDev.github.io/日志/npm 包构建基础</link>
            <guid>https://earthnutDev.github.io/日志/npm 包构建基础</guid>
            <pubDate>Sat, 08 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[开始构建 npm 包前需要考虑的]]></description>
            <content:encoded><![CDATA[<h2 class="anchor anchorTargetStickyNavbar_e79m" id="初始化-packagejson">初始化 package.json<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E5%88%9D%E5%A7%8B%E5%8C%96-packagejson" class="hash-link" aria-label="初始化 package.json的直接链接" title="初始化 package.json的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="执行初始化">执行初始化<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E6%89%A7%E8%A1%8C%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="执行初始化的直接链接" title="执行初始化的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> init </span><span class="token parameter variable" style="color:#36acaa">-y</span><br></span></code></pre></div></div>
<!-- -->
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="手动配置">手动配置<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E6%89%8B%E5%8A%A8%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="手动配置的直接链接" title="手动配置的直接链接" translate="no">​</a></h3>
<p>或者手动配置相关信息（包含未提及的功能）：</p>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"a-type-of-js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"module"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"version"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"1.0.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"main"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist/index.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"module"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist/index.esm.js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"types"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist/index.d.ts"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"files"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"dist"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"author"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earthnut"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"email"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earthnut.dev@outlook.com"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"url"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://earthunut.dev"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"description"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"a type of js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"keywords"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"type"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"license"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"MIT"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"homepage"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://earthnut.dev/npm/a-type-of-js"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"bugs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"url"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://github.com/earthnutDev/a-type-of-js/issues"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"email"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earthnut.dev@outlook.com"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"repository"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"type"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"git"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"url"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"git+https://github.com/earthnutDev/a-type-of-js.git"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"publishConfig"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"access"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"public"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"registry"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"https://registry.npmjs.org"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"devDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"rollup"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^2.67.0"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"@rollup/plugin-babel"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^6.0.2"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"@rollup/plugin-commonjs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^21.0.5"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"rollup -c rollup.config.js"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="代码格式化工具">代码格式化工具<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E4%BB%A3%E7%A0%81%E6%A0%BC%E5%BC%8F%E5%8C%96%E5%B7%A5%E5%85%B7" class="hash-link" aria-label="代码格式化工具的直接链接" title="代码格式化工具的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="安装依赖">安装依赖<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96" class="hash-link" aria-label="安装依赖的直接链接" title="安装依赖的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i --save-dev prettier</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置文件-prettierrc">配置文件 .prettierrc<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-prettierrc" class="hash-link" aria-label="配置文件 .prettierrc的直接链接" title="配置文件 .prettierrc的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"printWidth"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"tabWidth"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"useTabs"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"semi"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"singleQuote"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"trailingComma"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"es5"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"bracketSpacing"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"arrowParens"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"avoid"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"proseWrap"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"preserve"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"htmlWhitespaceSensitivity"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"css"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"endOfLine"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"lf"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置文件-prettierignore">配置文件 .prettierignore<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-prettierignore" class="hash-link" aria-label="配置文件 .prettierignore的直接链接" title="配置文件 .prettierignore的直接链接" translate="no">​</a></h3>
<div class="language-markdown codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-markdown codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">node_modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dist</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="执行脚本添加">执行脚本添加<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E6%89%A7%E8%A1%8C%E8%84%9A%E6%9C%AC%E6%B7%BB%E5%8A%A0" class="hash-link" aria-label="执行脚本添加的直接链接" title="执行脚本添加的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"format"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"prettier --write ."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="代码检查工具">代码检查工具<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7" class="hash-link" aria-label="代码检查工具的直接链接" title="代码检查工具的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="安装依赖-1">安装依赖<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96-1" class="hash-link" aria-label="安装依赖的直接链接" title="安装依赖的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># eslint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i --save-dev eslint eslint-config-prettier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># for typescript</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev @typescript-eslint/parser @typescript-eslint/eslint-plugin</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置文件-eslintrc">配置文件 .eslintrc<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-eslintrc" class="hash-link" aria-label="配置文件 .eslintrc的直接链接" title="配置文件 .eslintrc的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"env"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"browser"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"es2021"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"extends"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"eslint:recommended"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">"prettier/eslint-config-prettier"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"parser"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"@typescript-eslint/parser"</span><span class="token punctuation" style="color:#393A34">,</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="添加-lint-脚本">添加 lint 脚本<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E6%B7%BB%E5%8A%A0-lint-%E8%84%9A%E6%9C%AC" class="hash-link" aria-label="添加 lint 脚本的直接链接" title="添加 lint 脚本的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"lint"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"eslint . --fix"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="构建工具-git-">构建工具 git 🪝<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E6%9E%84%E5%BB%BA%E5%B7%A5%E5%85%B7-git-" class="hash-link" aria-label="构建工具 git 🪝的直接链接" title="构建工具 git 🪝的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="安装依赖-2">安装依赖<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96-2" class="hash-link" aria-label="安装依赖的直接链接" title="安装依赖的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i --save-dev husky lint-staged</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置文件-packagejson">配置文件 package.json<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-packagejson" class="hash-link" aria-label="配置文件 package.json的直接链接" title="配置文件 package.json的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"lint-staged"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"*.{js,ts}"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"prettier --write"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"eslint --fix"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"git add"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"prepare"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"husky install"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="初始化-husky">初始化 Husky<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E5%88%9D%E5%A7%8B%E5%8C%96-husky" class="hash-link" aria-label="初始化 Husky的直接链接" title="初始化 Husky的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> run prepare</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">npx husky </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> .husky/pre-commit </span><span class="token string" style="color:#e3116c">"npx lint-staged"</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="测试框架-jest-为例">测试框架 （jest 为例）<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6-jest-%E4%B8%BA%E4%BE%8B" class="hash-link" aria-label="测试框架 （jest 为例）的直接链接" title="测试框架 （jest 为例）的直接链接" translate="no">​</a></h2>
<p>可参考 <a class="" href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/jest%20%E7%9A%84%E4%BD%BF%E7%94%A8">jest</a></p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="安装依赖-3">安装依赖<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96-3" class="hash-link" aria-label="安装依赖的直接链接" title="安装依赖的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># jest</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i --save-dev jest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># for typescript</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i --save-dev ts-jest @types/jest</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置文件-jestconfigjs">配置文件 jest.config.js<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-jestconfigjs" class="hash-link" aria-label="配置文件 jest.config.js的直接链接" title="配置文件 jest.config.js的直接链接" translate="no">​</a></h3>
<div class="language-js codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-js codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">testEnvironment</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'node'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">testMatch</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">'**/__tests__/**/*.[jt]s?(x)'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'**/?(*.)+(spec|test).[tj]s?(x)'</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token literal-property property" style="color:#36acaa">coverageDirectory</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'coverage'</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="添加测试脚本">添加测试脚本<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E6%B7%BB%E5%8A%A0%E6%B5%8B%E8%AF%95%E8%84%9A%E6%9C%AC" class="hash-link" aria-label="添加测试脚本的直接链接" title="添加测试脚本的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"test"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"jest"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="typescript-支持">typescript 支持<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#typescript-%E6%94%AF%E6%8C%81" class="hash-link" aria-label="typescript 支持的直接链接" title="typescript 支持的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="安装依赖-4">安装依赖<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96-4" class="hash-link" aria-label="安装依赖的直接链接" title="安装依赖的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> i --save-dev typescript @types/node</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="配置文件-tsconfigjson">配置文件 tsconfig.json<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-tsconfigjson" class="hash-link" aria-label="配置文件 tsconfig.json的直接链接" title="配置文件 tsconfig.json的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"compilerOptions"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"target"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"esnext"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"module"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"esnext"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"moduleResolution"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"node"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"lib"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"esnext"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dom"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"esModuleInterop"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"skipLibCheck"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"strict"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"noEmit"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"resolveJsonModule"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"allowSyntheticDefaultImports"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"forceConsistentCasingInFileNames"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"noImplicitReturns"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"noFallthroughCasesInSwitch"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"noUnusedLocals"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"noUnusedParameters"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"noImplicitAny"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"noImplicitThis"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"noImplicitOverride"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"sourceMap"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"emitDeclarationOnly"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"declaration"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"outDir"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"declarationDir"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist/types"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"include"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"src/**/*.ts"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"exclude"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"node_modules"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"dist"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"**/*.test.ts"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="文件模版">文件模版<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#%E6%96%87%E4%BB%B6%E6%A8%A1%E7%89%88" class="hash-link" aria-label="文件模版的直接链接" title="文件模版的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="gitignore">.gitignore<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#gitignore" class="hash-link" aria-label=".gitignore的直接链接" title=".gitignore的直接链接" translate="no">​</a></h3>
<div class="language-markdown codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-markdown codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">node_modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.DS_Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.idea/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="npmignore">.npmignore<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/npm%20%E5%8C%85%E6%9E%84%E5%BB%BA%E5%9F%BA%E7%A1%80#npmignore" class="hash-link" aria-label=".npmignore的直接链接" title=".npmignore的直接链接" translate="no">​</a></h3>
<div class="language-markdown codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-markdown codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">node_modules/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">dist</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.DS_Store</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">.idea/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tsconfig.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">jest.config.js</span><br></span></code></pre></div></div>]]></content:encoded>
            <category>npm 包</category>
        </item>
        <item>
            <title><![CDATA[初用 Cloudflare Pages]]></title>
            <link>https://earthnutDev.github.io/日志/初用 Cloudflare Pages</link>
            <guid>https://earthnutDev.github.io/日志/初用 Cloudflare Pages</guid>
            <pubDate>Fri, 07 Mar 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[现有 next.js 部署到 Cloudflare Pages]]></description>
            <content:encoded><![CDATA[<p>之前的 next.js 部署在自己的 <a href="htttps://lmssee.com" target="_blank" rel="noopener noreferrer" class="">个人服务器</a> 之中，后来就想着这域名没什么辨识度，就购买了 <a href="https://earthnut.dev/" target="_blank" rel="noopener noreferrer" class="">earthnut.dev</a> 域名，但是国内目前不接受顶级域名 <a href="https://www.icpbeian.gov.cn/" target="_blank" rel="noopener noreferrer" class="">.dev</a> 的备案。</p>
<p>一开始想着使用 <code>A</code> 记录的方式绕过备案体系，于是就喜提腾讯云的“域名未备案”提示。于是使用了 <code>CNAME</code> 记录方式指向了域名 <a href="https://lmssee.com/" target="_blank" rel="noopener noreferrer" class="">lmssee.com</a>，通过在 nginx 中配置 <code>server_name</code> 来实现跳转，并且在实际的前后端进行配置实现接口的自由访问。</p>
<!-- -->
<p>一开始访问正常，然而没过两天就出现了访问提示 "嗯… 无法访问此页面 已重置连接。"，需要多次刷新页面才可以访问。</p>
<p>嗯，如果是这样的话，这个域名好像白买了，因为多则需要数十次的刷新才可以正常访问。</p>
<p>我可以容忍你加载慢，但是你显示无法访问那就不行了不是。</p>
<p>于是，找大佬。Cloudflare Pages 是一个基于 GitHub Actions 的静态站点托管服务，可以快速部署 Next.js 项目。</p>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="cloudflare-pages">Cloudflare Pages<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E5%88%9D%E7%94%A8%20Cloudflare%20Pages#cloudflare-pages" class="hash-link" aria-label="Cloudflare Pages的直接链接" title="Cloudflare Pages的直接链接" translate="no">​</a></h2>
<p>跟着 <a href="https://developers.cloudflare.com/pages/framework-guides/nextjs/ssr/get-started/" target="_blank" rel="noopener noreferrer" class="">官方文档开始使用</a> 在现有 next.js 项目中添加 Cloudflare Pages。</p>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="安装依赖包">安装依赖包<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E5%88%9D%E7%94%A8%20Cloudflare%20Pages#%E5%AE%89%E8%A3%85%E4%BE%9D%E8%B5%96%E5%8C%85" class="hash-link" aria-label="安装依赖包的直接链接" title="安装依赖包的直接链接" translate="no">​</a></h3>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> --save-dev @cloudflare/next-on-pages</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="创建-wranglerjsonc-文件">创建 wrangler.jsonc 文件<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E5%88%9D%E7%94%A8%20Cloudflare%20Pages#%E5%88%9B%E5%BB%BA-wranglerjsonc-%E6%96%87%E4%BB%B6" class="hash-link" aria-label="创建 wrangler.jsonc 文件的直接链接" title="创建 wrangler.jsonc 文件的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"$schema"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"node_modules/wrangler/config-schema.json"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"name"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"earthnut"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"compatibility_date"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"2025-03-03"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"compatibility_flags"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">"nodejs_compat"</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"pages_build_output_dir"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"./.vercel/output/static"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"observability"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"enabled"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="更新-nextconfigjs-文件">更新 next.config.js 文件<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E5%88%9D%E7%94%A8%20Cloudflare%20Pages#%E6%9B%B4%E6%96%B0-nextconfigjs-%E6%96%87%E4%BB%B6" class="hash-link" aria-label="更新 next.config.js 文件的直接链接" title="更新 next.config.js 文件的直接链接" translate="no">​</a></h3>
<div class="language-ts codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-ts codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> setupDevPlatform </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'@cloudflare/next-on-pages/next-dev'</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token doc-comment comment" style="color:#999988;font-style:italic">/** </span><span class="token doc-comment comment keyword" style="color:#00009f;font-style:italic">@type</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> </span><span class="token doc-comment comment punctuation" style="color:#393A34;font-style:italic">{</span><span class="token doc-comment comment" style="color:#999988;font-style:italic">import('next').NextConfig</span><span class="token doc-comment comment punctuation" style="color:#393A34;font-style:italic">}</span><span class="token doc-comment comment" style="color:#999988;font-style:italic"> */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> nextConfig </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">process</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">env</span><span class="token punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">NODE_ENV</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">===</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'development'</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">await</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">setupDevPlatform</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">default</span><span class="token plain"> nextConfig</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="更新-packagejson-文件">更新 package.json 文件<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E5%88%9D%E7%94%A8%20Cloudflare%20Pages#%E6%9B%B4%E6%96%B0-packagejson-%E6%96%87%E4%BB%B6" class="hash-link" aria-label="更新 package.json 文件的直接链接" title="更新 package.json 文件的直接链接" translate="no">​</a></h3>
<div class="language-json codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-json codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"scripts"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"build"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"next build &amp;&amp; next-on-pages build"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"dev"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"next dev"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"start"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"next start"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"lint"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"next lint"</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"postinstall"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"next-on-pages postinstall"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">"devDependencies"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">"@cloudflare/next-on-pages"</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">"^0.0.17"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_e79m" id="确保所有的服务器渲染的路由都是使用-edge-运行时">确保所有的服务器渲染的路由都是使用 Edge 运行时<a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E5%88%9D%E7%94%A8%20Cloudflare%20Pages#%E7%A1%AE%E4%BF%9D%E6%89%80%E6%9C%89%E7%9A%84%E6%9C%8D%E5%8A%A1%E5%99%A8%E6%B8%B2%E6%9F%93%E7%9A%84%E8%B7%AF%E7%94%B1%E9%83%BD%E6%98%AF%E4%BD%BF%E7%94%A8-edge-%E8%BF%90%E8%A1%8C%E6%97%B6" class="hash-link" aria-label="确保所有的服务器渲染的路由都是使用 Edge 运行时的直接链接" title="确保所有的服务器渲染的路由都是使用 Edge 运行时的直接链接" translate="no">​</a></h3>
<p>next.js 的默认配置是使用 <a href="https://nextjs.org/docs/app/building-your-application/rendering/edge-and-nodejs-runtimes" target="_blank" rel="noopener noreferrer" class="">Node.js 运行时</a>，但是 Cloudflare Pages 是使用 Edge 运行时，所以需要手。</p>
<p>所以需要在每一个页面添加：</p>
<div class="language-ts codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-ts codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">export</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> runtime </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">'edge'</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_e79m" id="运行项目时的-__import_unsupported">运行项目时的 <code>__import_unsupported</code><a href="https://earthnutdev.github.io/%E6%97%A5%E5%BF%97/%E5%88%9D%E7%94%A8%20Cloudflare%20Pages#%E8%BF%90%E8%A1%8C%E9%A1%B9%E7%9B%AE%E6%97%B6%E7%9A%84-__import_unsupported" class="hash-link" aria-label="运行项目时的-__import_unsupported的直接链接" title="运行项目时的-__import_unsupported的直接链接" translate="no">​</a></h2>
<p>这时候，暗照官方推荐的在已有的 next.js 项目中添加 Cloudflare Pages 就已经结束了。然而，在执行 <code>npm run preview</code> 时，会提示：</p>
<div class="language-bash codeBlockContainer_zKmq theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_yZYC"><pre tabindex="0" class="prism-code language-bash codeBlock_k5IM thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines__4YI"><span class="token-line" style="color:#393A34"><span class="token plain">✘ </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">ERROR</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> TypeError: Cannot redefine property: __import_unsupported</span><br></span></code></pre></div></div>
<p>翻译一下略了解是由于 <code>__import_unsupported</code> 这个变量已经存在，但是被重新定义了，所以报错。</p>
<p>但是我没有定义这个变量呀，开个玩笑哈。</p>
<p>各种翻箱倒柜，什么全球最后的 <a href="https://www.doubao.com/chat/" target="_blank" rel="noopener noreferrer" class="">ai 豆包</a>也问过、全球最支持开发者的<a href="https://tongyi.aliyun.com/qianwen/" target="_blank" rel="noopener noreferrer" class="">通义</a>咨询过，什么 ds buff 加身的满血版<a href="https://yuanbao.tencent.com/chat/" target="_blank" rel="noopener noreferrer" class="">元宝</a>当然也不会放过，还有目前天天送超级超级超级会员的 <a href="https://yiyan.baidu.com/chat/" target="_blank" rel="noopener noreferrer" class="">文心大模型 4.0 Turbo 版</a>。</p>
<p>当然，像你想的那样，ai 加持的国产 4 大“智障”回答出奇的一致。</p>
<p>然后就是官网加社区找答案了。然而，没有人遇见过这么智障的错误。</p>
<p>为什么说智障呢？当然，如果你遇见了同样的问题，我说的也是你，而不是这个问题。</p>
<p>原因是官方在推荐在现有项目中添加 <a href="https://github.com/cloudflare/next-on-pages#readme" target="_blank" rel="noopener noreferrer" class=""><code>@cloudflare/next-on-pages</code></a> 时，并没有提及 <code>next.js</code> 的版本问题，我的现有项目中 <code>package.json</code> 显示为 <code>next.js</code> 版本是 <code>15.1.3</code> ，实际安装版本为 <code>15.2.1</code>。后使用 <code>npm install --save next@15.2.*</code> 版本均出现该错误，而在 <code>npm install --save next@15.1.*</code> 版本则没有问题。</p>
<p>愚蠢如我，阿门。</p>]]></content:encoded>
            <category>cloudflare</category>
        </item>
    </channel>
</rss>