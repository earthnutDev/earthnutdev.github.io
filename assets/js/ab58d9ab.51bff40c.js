"use strict";(self.webpackChunkearthnut_doc_of_docusaurus=self.webpackChunkearthnut_doc_of_docusaurus||[]).push([[7361],{562:e=>{e.exports=JSON.parse('{"permalink":"/\u65e5\u5fd7/\u6d4b\u8bd5\u8986\u76d6\u7387","source":"@site/blog/2025-3-10-\u6d4b\u8bd5\u8986\u76d6\u7387.mdx","title":"\u6d4b\u8bd5\u8986\u76d6\u7387","description":"\u4f7f\u7528 Coverage\u3001Codecov \u6216 SonarCloud \u751f\u6210\u6d4b\u8bd5\u8986\u76d6\u7387","date":"2025-03-10T00:00:00.000Z","tags":[{"inline":false,"label":"\u6d4b\u8bd5","permalink":"/\u65e5\u5fd7/tags/test/","description":"\u5b66\u4e60\u6d4b\u8bd5"}],"readingTime":5.2,"hasTruncateMarker":true,"authors":[],"frontMatter":{"slug":"\u6d4b\u8bd5\u8986\u76d6\u7387","title":"\u6d4b\u8bd5\u8986\u76d6\u7387","tags":["\u6d4b\u8bd5"],"description":"\u4f7f\u7528 Coverage\u3001Codecov \u6216 SonarCloud \u751f\u6210\u6d4b\u8bd5\u8986\u76d6\u7387"},"unlisted":false,"prevItem":{"title":"github actions","permalink":"/\u65e5\u5fd7/github actions"},"nextItem":{"title":"npm \u5305\u5176\u4ed6\u6784\u5efa","permalink":"/\u65e5\u5fd7/npm \u5305\u6784\u5efa\u5176\u4ed6"}}')},4744:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>r,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var c=s(562),t=s(7259),o=s(9087);const l={slug:"\u6d4b\u8bd5\u8986\u76d6\u7387",title:"\u6d4b\u8bd5\u8986\u76d6\u7387",tags:["\u6d4b\u8bd5"],description:"\u4f7f\u7528 Coverage\u3001Codecov \u6216 SonarCloud \u751f\u6210\u6d4b\u8bd5\u8986\u76d6\u7387"},r="\u6d4b\u8bd5\u8986\u76d6\u7387",i={authorsImageUrls:[]},a=[{value:"\ud83d\udd27",id:"",level:2},{value:"\ud83d\udd27 Coveralls",id:"-coveralls",level:2},{value:"1. \u5b89\u88c5",id:"1-\u5b89\u88c5",level:3},{value:"2. \u914d\u7f6e",id:"2-\u914d\u7f6e",level:3},{value:"\u5728 <code>package.json</code> \u6587\u4ef6\u4e2d\u6dfb\u52a0 <code>scripts</code> \u914d\u7f6e",id:"\u5728-packagejson-\u6587\u4ef6\u4e2d\u6dfb\u52a0-scripts-\u914d\u7f6e",level:4},{value:"\u5728 <code>jest.config.js</code> \u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e",id:"\u5728-jestconfigjs-\u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e",level:4},{value:"github actions \u914d\u7f6e",id:"github-actions-\u914d\u7f6e",level:4},{value:"3. coveralls \u96c6\u6210",id:"3-coveralls-\u96c6\u6210",level:3},{value:"4. \u672c\u5730\u8c03\u8bd5\u547d\u4ee4",id:"4-\u672c\u5730\u8c03\u8bd5\u547d\u4ee4",level:3},{value:"5. \u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a",id:"5-\u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a",level:3},{value:"\ud83d\udd27 Codecov",id:"-codecov",level:2},{value:"1. \u5b89\u88c5",id:"1-\u5b89\u88c5-1",level:3},{value:"2. \u914d\u7f6e",id:"2-\u914d\u7f6e-1",level:3},{value:"\u5728 <code>package.json</code> \u6587\u4ef6\u4e2d\u6dfb\u52a0 <code>scripts</code> \u914d\u7f6e",id:"\u5728-packagejson-\u6587\u4ef6\u4e2d\u6dfb\u52a0-scripts-\u914d\u7f6e-1",level:4},{value:"\u5728 <code>jest.config.js</code> \u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e (\u540c coveralls)",id:"\u5728-jestconfigjs-\u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e-\u540c-coveralls",level:4},{value:"github actions \u914d\u7f6e",id:"github-actions-\u914d\u7f6e-1",level:4},{value:"3. codecov \u96c6\u6210",id:"3-codecov-\u96c6\u6210",level:3},{value:"4. \u672c\u5730\u8c03\u8bd5\u547d\u4ee4",id:"4-\u672c\u5730\u8c03\u8bd5\u547d\u4ee4-1",level:3},{value:"5. \u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a",id:"5-\u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a-1",level:3},{value:"\u5b8c\u6574\u7684\u793a\u4f8b",id:"\u5b8c\u6574\u7684\u793a\u4f8b",level:2},{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:3},{value:"\u914d\u7f6e jest.config.js",id:"\u914d\u7f6e-jestconfigjs",level:3},{value:"\u914d\u7f6e package.json",id:"\u914d\u7f6e-packagejson",level:3},{value:"\u96c6\u6210 codecov\u3001coveralls",id:"\u96c6\u6210-codecovcoveralls",level:3},{value:"\u6700\u7ec8\u7684 coverage.yml",id:"\u6700\u7ec8\u7684-coverageyml",level:3},{value:"\u53c2\u8003\u8d44\u6599",id:"\u53c2\u8003\u8d44\u6599",level:2}];function d(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"\u6d4b\u8bd5\u8986\u76d6\u7387\u662f\u6d4b\u8bd5\u4ee3\u7801\u7684\u8d28\u91cf\uff0c\u5b83\u8868\u793a\u4ee3\u7801\u88ab\u6d4b\u8bd5\u7684\u767e\u5206\u6bd4\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u5728\u7cfb\u7edf\u5b66\u4e60\u6784\u5efa npm \u5305\u65f6\uff0c\u53d1\u73b0\u5728\u63a8\u8350\u7684\u5fbd\u7ae0\u5c55\u793a\u4e2d\u5305\u542b\u6d4b\u8bd5\u8986\u76d6\u7387\u7684\u5fbd\u7ae0\uff0c\u6709\u52a9\u4e8e\u5e2e\u52a9\u7528\u6237\u4e86\u89e3\u4ee3\u7801\u7684\u8d28\u91cf\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u4f46\u662f\u8c8c\u4f3c\u9047\u89c1\u4e86\u6211\u7684\u77e5\u8bc6\u76f2\u533a\uff0c\u9042\u5b66\u4e14\u8bb0\u4e4b\u3002"}),"\n","\n",(0,t.jsx)(n.h2,{id:"",children:"\ud83d\udd27"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"\ud83d\udd27"}),(0,t.jsx)(n.th,{children:"\u7279\u70b9"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"Coveralls"})}),(0,t.jsx)(n.td,{children:"\u652f\u6301\u591a\u79cd\u8bed\u8a00\uff0c\u4e0e github \u96c6\u6210\u7b80\u5355\uff0c\u9002\u5408\u5f00\u6e90\u9879\u76ee"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"codecov"})}),(0,t.jsx)(n.td,{children:"\u652f\u6301 \u66f4\u8be6\u7ec6\u7684\u62a5\u544a\u5206\u6790\uff0c\u9002\u5408\u590d\u6742\u7684\u9879\u76ee"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"SonarCloud"}),(0,t.jsx)(n.td,{children:"\u63d0\u4f9b\u4ee3\u7801\u8d28\u91cf + \u8986\u76d6\u7387\u7efc\u5408\u62a5\u544a\uff0c\u9002\u5408\u4f01\u4e1a\u7ea7\u7684\u9879\u76ee"})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["\u8fd9\u91cc\u4ee5 ",(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"coveralls"})," \u53ca ",(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"codecov"})," \u4e3a\u4f8b\u3002"]}),"\n",(0,t.jsxs)(n.h2,{id:"-coveralls",children:["\ud83d\udd27 ",(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"Coveralls"})]}),"\n",(0,t.jsx)(n.h3,{id:"1-\u5b89\u88c5",children:"1. \u5b89\u88c5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev jest jest-junit coveralls # \u751f\u6210 JUnit \u683c\u5f0f\u6d4b\u8bd5\u62a5\u544a\nnpm install --save-dev ts-jest ts-node @types/jest\nnpm install --save-dev jest-environment-jsdom\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u914d\u7f6e",children:"2. \u914d\u7f6e"}),"\n",(0,t.jsxs)(n.h4,{id:"\u5728-packagejson-\u6587\u4ef6\u4e2d\u6dfb\u52a0-scripts-\u914d\u7f6e",children:["\u5728 ",(0,t.jsx)(n.code,{children:"package.json"})," \u6587\u4ef6\u4e2d\u6dfb\u52a0 ",(0,t.jsx)(n.code,{children:"scripts"})," \u914d\u7f6e"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'"scripts": {\n  "test": "jest --coverage",\n  "report": "cat ./coverage/lcov.info | coveralls"\n}\n'})}),"\n",(0,t.jsxs)(n.h4,{id:"\u5728-jestconfigjs-\u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e",children:["\u5728 ",(0,t.jsx)(n.code,{children:"jest.config.js"})," \u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"node --eval=\"fs.mkdirSync('.github/workflows', { recursive: true })\"\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js"',children:"module.exports = {\n  collectCoverage: true,\n  coverageDirectory: 'coverage',\n  coverageReporters: ['lcov', 'text-summary'],\n  collectCoverageFrom: [\n    'src/**/*.{js,jsx}',\n    '!**/node_modules/**',\n    '!**/vendor/**',\n  ],\n};\n"})}),"\n",(0,t.jsx)(n.h4,{id:"github-actions-\u914d\u7f6e",children:"github actions \u914d\u7f6e"}),"\n",(0,t.jsx)(n.p,{children:"\u521b\u5efa\uff08\u5df2\u6709\u53ef\u4fee\u6539\uff09.github/workflows/coverage.yml \u6587\u4ef6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"node --eval \"fs.mkdirSync('.github/workflows/', { recursive: true })\"\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title=".github/workflows/coverage.yml"',children:"name: Run tests and upload coverage\n\non:\n  push:\n    branches: [main]\n    # tags: ['*']\n\njobs:\n  test:\n    name: Run tests and collect coverage\n    runs-on: ubuntu-latest\n    # \u4ec5\u5f53\u63d0\u4ea4\u6d88\u606f\u5305\u542b \"version\" \u65f6\u8fd0\u884c\u81ea\u52a8\u5316\u6d4b\u8bd5\n    if: contains(github.event.head_commit.message, 'version')\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Set up Node\n        uses: actions/setup-node@v4\n        with:\n          node-version: 20.x\n\n      - name: Install dependencies\n        run: npm install\n\n      - name: Run tests\n        run: npx jest --coverage\n\n      - name: copy coverage to test-coverage directory\n        uses: coverallsapp/github-action@v2\n        with:\n          github-token: ${{ secrets.GITHUB_TOKEN}} # ${{ secrets.COVERALLS_REPO_TOKEN }}\n          path-to-lcov: ./coverage/lcov.info\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-coveralls-\u96c6\u6210",children:"3. coveralls \u96c6\u6210"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u83b7\u53d6 token\uff08\u5f00\u6e90\u4ed3\u5e93\u53ef\u4ee5\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"GITHUB_TOKEN"})," \u4ee3\u66ff\uff09","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u767b\u5f55 [",(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"https://coveralls.io/"}),"]"]}),"\n",(0,t.jsxs)(n.li,{children:["\u70b9\u51fb ",(0,t.jsx)(n.code,{children:"Add Repo"})," \u6309\u94ae\uff0c\u6dfb\u52a0\u4ed3\u5e93"]}),"\n",(0,t.jsx)(n.li,{children:"\u83b7\u53d6 COVERALLS_REPO_TOKEN (\u81ea\u52a8\u751f\u6210)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u914d\u7f6e github secrets","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5728 Settings \u27a1\ufe0f secrets \u27a1\ufe0f Actions \u6dfb\u52a0\uff1a ",(0,t.jsx)(n.code,{children:"COVERALLS_REPO_TOKEN: <your_token>"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"COVERALLS_REPO_TOKEN: <your-token>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-\u672c\u5730\u8c03\u8bd5\u547d\u4ee4",children:"4. \u672c\u5730\u8c03\u8bd5\u547d\u4ee4"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"COVERALLS_REPO_TOKEN=your_token npm run report\n"})}),"\n",(0,t.jsx)(n.h3,{id:"5-\u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a",children:"5. \u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a"}),"\n",(0,t.jsxs)(n.p,{children:["\u4e0b\u9762\u662f ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/a-type-of-js",children:"a-type-of-js"})," \u7684 ",(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"coveralls"})," \u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a ",(0,t.jsx)(n.a,{href:"https://coveralls.io/github/earthnutDev/a-type-of-js?branch=main",children:(0,t.jsx)(n.img,{src:"https://coveralls.io/repos/github/earthnutDev/a-type-of-js/badge.svg?branch=main",alt:"Coverage Status"})})]}),"\n",(0,t.jsxs)(n.h2,{id:"-codecov",children:["\ud83d\udd27 ",(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"Codecov"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"Codecov"})," \u662f\u4e00\u4e2a\u5f00\u6e90\u7684\u4ee3\u7801\u8986\u76d6\u7387\u5e73\u53f0\uff0c\u5b83\u63d0\u4f9b\u4e86\u8be6\u7ec6\u7684\u62a5\u544a\u5206\u6790\uff0c\u9002\u5408\u590d\u6742\u7684\u9879\u76ee\u3002\n",(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"Codecov"})," \u652f\u6301\u591a\u79cd\u8bed\u8a00\uff0c\u5305\u62ec JavaScript\u3001Python\u3001Ruby\u3001Java\u3001C++\u3001C#\u3001Go\u3001Swift\u3001Kotlin\u3001Rust\u3001PHP\u3001R\u3001Scala\u3001Perl\u3001Lua\u3001Erlang\u3001Haskell\u3001OCaml\u3001Clojure\u3001Elixir\u3001Pascal\u3001Dart\u3001Racket\u3001Lisp\u3001Fortran\u3001Ada\u3001Prolog\u3001VBScript\u3001VBA\u3001Visual Basic\u3001Objective-C\u3001Objective-C++\u3001Assembly\u3001C\u3002"]}),"\n",(0,t.jsx)(n.h3,{id:"1-\u5b89\u88c5-1",children:"1. \u5b89\u88c5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev jest jest-junit codecov # \u751f\u6210 JUnit \u683c\u5f0f\u6d4b\u8bd5\u62a5\u544a\nnpm install --save-dev ts-jest ts-node @types/jest\nnpm install --save-dev jest-environment-jsdom\n"})}),"\n",(0,t.jsx)(n.h3,{id:"2-\u914d\u7f6e-1",children:"2. \u914d\u7f6e"}),"\n",(0,t.jsxs)(n.h4,{id:"\u5728-packagejson-\u6587\u4ef6\u4e2d\u6dfb\u52a0-scripts-\u914d\u7f6e-1",children:["\u5728 ",(0,t.jsx)(n.code,{children:"package.json"})," \u6587\u4ef6\u4e2d\u6dfb\u52a0 ",(0,t.jsx)(n.code,{children:"scripts"})," \u914d\u7f6e"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'"scripts": {\n  "test": "jest --coverage",\n  "coverage": "codecov"\n}\n'})}),"\n",(0,t.jsxs)(n.h4,{id:"\u5728-jestconfigjs-\u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e-\u540c-coveralls",children:["\u5728 ",(0,t.jsx)(n.code,{children:"jest.config.js"})," \u6587\u4ef6\u4e2d\u6dfb\u52a0\u914d\u7f6e (\u540c ",(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"coveralls"}),")"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js"',children:"module.exports = {\n  collectCoverage: true,\n  coverageDirectory: 'coverage',\n  coverageReporters: ['lcov', 'text-summary'],\n  collectCoverageFrom: [\n    'src/**/*.{js,jsx}',\n    '!**/node_modules/**',\n    '!**/vendor/**',\n  ],\n};\n"})}),"\n",(0,t.jsx)(n.h4,{id:"github-actions-\u914d\u7f6e-1",children:"github actions \u914d\u7f6e"}),"\n",(0,t.jsx)(n.p,{children:"\u521b\u5efa\uff08\u5df2\u6709\u53ef\u4fee\u6539\uff09.github/workflows/coverage.yml \u6587\u4ef6"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"node --eval \"fs.mkdirSync('.github/workflows/', { recursive: true })\"\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title=".github/workflows/coverage.yml"',children:"name: Run tests and upload coverage\n\non:\n  push:\n    branches: [main]\n    # tags: ['*']\n\njobs:\n  test:\n    name: Run tests and collect coverage\n    runs-on: ubuntu-latest\n    # \u4ec5\u5f53\u63d0\u4ea4\u6d88\u606f\u5305\u542b \"version\" \u65f6\u8fd0\u884c\u81ea\u52a8\u5316\u6d4b\u8bd5\n    if: contains(github.event.head_commit.message, 'version')\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Set up Node\n        uses: actions/setup-node@v4\n        with:\n          node-version: 20.x\n\n      - name: Install dependencies\n        run: npm install\n\n      - name: Run tests\n        run: npx jest --coverage\n\n      - name: Upload results to Codecov\n        uses: codecov/codecov-action@v5\n        with:\n          # token: ${{ secrets.CODECOV_TOKEN }} # \u4ec5\u79c1\u4eba\u4ed3\u5e93\u9700\u8981\n          files: ./coverage/lcov.info\n          verbose: true\n"})}),"\n",(0,t.jsx)(n.h3,{id:"3-codecov-\u96c6\u6210",children:"3. codecov \u96c6\u6210"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u83b7\u53d6 ",(0,t.jsx)(n.code,{children:"token"}),"\uff08\u516c\u5f00\u4ed3\u5e93\u53ef\u4ee5\u7701\u7565 ",(0,t.jsx)(n.code,{children:"token"}),"\uff09","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u767b\u5f55 ",(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"codecov"})]}),"\n",(0,t.jsxs)(n.li,{children:["\u70b9\u51fb ",(0,t.jsx)(n.code,{children:"Add Repo"})," \u6309\u94ae\uff0c\u6dfb\u52a0\u4ed3\u5e93"]}),"\n",(0,t.jsx)(n.li,{children:"\u83b7\u53d6 CODECOV_TOKEN (\u81ea\u52a8\u751f\u6210)"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\u914d\u7f6e github secrets","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5728 Settings \u27a1\ufe0f secrets \u27a1\ufe0f Actions \u6dfb\u52a0\uff1a ",(0,t.jsx)(n.code,{children:"CODECOV_TOKEN: <your_token>"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"CODECOV_TOKEN: <your-token>\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-\u672c\u5730\u8c03\u8bd5\u547d\u4ee4-1",children:"4. \u672c\u5730\u8c03\u8bd5\u547d\u4ee4"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"CODECOV_TOKEN=your_token npm run coverage\n"})}),"\n",(0,t.jsx)(n.h3,{id:"5-\u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a-1",children:"5. \u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a"}),"\n",(0,t.jsxs)(n.p,{children:["\u4e0b\u9762\u662f ",(0,t.jsx)(n.a,{href:"https://www.npmjs.com/a-type-of-js",children:"a-type-of-js"})," \u7684 ",(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"codecov"})," \u6d4b\u8bd5\u8986\u76d6\u7387\u62a5\u544a ",(0,t.jsx)(n.a,{href:"https://codecov.io/gh/earthnutDev/a-type-of-js",children:(0,t.jsx)(n.img,{src:"https://codecov.io/gh/earthnutDev/a-type-of-js/branch/main/graph/badge.svg",alt:"codecov"})})]}),"\n",(0,t.jsx)(n.h2,{id:"\u5b8c\u6574\u7684\u793a\u4f8b",children:"\u5b8c\u6574\u7684\u793a\u4f8b"}),"\n",(0,t.jsx)(n.h3,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install --save-dev jest jest-junit coveralls codecov # \u751f\u6210 JUnit \u683c\u5f0f\u6d4b\u8bd5\u62a5\u544a\nnpm install --save-dev ts-jest ts-node @types/jest\nnpm install --save-dev jest-environment-jsdom\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u914d\u7f6e-jestconfigjs",children:"\u914d\u7f6e jest.config.js"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",metastring:'title="jest.config.js"',children:"/** @type {import('ts-jest').JestConfigWithTsJest} **/\nexport default () => {\n  return {\n    collectCoverage: true,\n    collectCoverageFrom: ['index.ts', '!**/node_modules/**', '!**/vendor/**'],\n    coveragePathIgnorePatterns: ['/node_modules/', '/dist/', 'test', '.*.d.ts'],\n    coverageReporters: ['text', 'lcov', 'html', 'text-summary'],\n    coverageDirectory: 'coverage',\n    preset: 'ts-jest',\n    verbose: true,\n    testEnvironment: 'node',\n    transform: {\n      '^.+\\\\.tsx?$': [\n        'ts-jest',\n        {\n          isolatedModules: true,\n          tsconfig: 'tsconfig.json',\n        },\n      ],\n    },\n    testMatch: ['**/*.test.(js|ts|tsx)'],\n  };\n};\n"})}),"\n",(0,t.jsx)(n.h3,{id:"\u914d\u7f6e-packagejson",children:"\u914d\u7f6e package.json"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n  "scripts": {\n    "test": "jest --coverage",\n    "report": "cat ./coverage/lcov.info | coveralls",\n    "coverage": "codecov"\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.h3,{id:"\u96c6\u6210-codecovcoveralls",children:["\u96c6\u6210 ",(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"codecov"}),"\u3001",(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"coveralls"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u4f7f\u7528 github \u8d26\u53f7\u5206\u522b\u767b\u5f55 ",(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"codecov"}),"\u3001",(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"coveralls"})]}),"\n",(0,t.jsx)(n.li,{children:"\u6dfb\u52a0\u4ed3\u5e93"}),"\n",(0,t.jsxs)(n.li,{children:["\u83b7\u53d6 token \uff08\u975e\u79c1\u4eba\u4ed3\u5e93\u53ef\u4ee5\u7701\u7565 ",(0,t.jsx)(n.code,{children:"token"}),"\uff09"]}),"\n",(0,t.jsx)(n.li,{children:"\u914d\u7f6e github secrets"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"\u6700\u7ec8\u7684-coverageyml",children:"\u6700\u7ec8\u7684 coverage.yml"}),"\n","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"node --eval \"fs.mkdirSync('.github/workflows/', { recursive: true })\"\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yml",metastring:'title=".github/workflows/coverage.yml"',children:"name: Run tests and upload coverage\n\non:\n  push:\n    branches: [main]\n\njobs:\n  test:\n    name: Run tests and collect coverage\n    runs-on: ubuntu-latest\n    if: contains(github.event.head_commit.message, 'version')\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Set up Node\n        uses: actions/setup-node@v4\n        with:\n          node-version: 20.x\n\n      - name: Install dependencies\n        run: npm install\n\n      - name: Run tests\n        run: npx jest --coverage\n\n      - name: Upload results to Codecov\n        uses: codecov/codecov-action@v5\n        with:\n          # token: ${{ secrets.CODECOV_TOKEN }}\n          files: ./coverage/lcov.info\n          verbose: true\n\n      - name: copy coverage to test-coverage directory\n        uses: coverallsapp/github-action@v2\n        with:\n          github-token: ${{ secrets.GITHUB_TOKEN }}\n          path-to-lcov: ./coverage/lcov.info\n"})}),"\n",(0,t.jsx)(n.h2,{id:"\u53c2\u8003\u8d44\u6599",children:"\u53c2\u8003\u8d44\u6599"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://coveralls.io/",children:"Coveralls"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://codecov.io/",children:"Codecov"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"https://www.npmjs.com/a-type-of-js",children:"a-type-of-js"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},9087:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>r});var c=s(6363);const t={},o=c.createContext(t);function l(e){const n=c.useContext(o);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),c.createElement(o.Provider,{value:n},e.children)}}}]);